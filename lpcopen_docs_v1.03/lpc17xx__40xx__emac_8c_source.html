<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LPCOpen Platform: C:/nxp/v1.03/lpcopen_v1.03/lpcopen/software/lwip/lpclwip/arch/lpc17xx_40xx_emac.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="driver.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LPCOpen Platform
   &#160;<span id="projectnumber">v1.03</span>
   </div>
   <div id="projectbrief">LPCOpen Platform for NXP LPC Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lpc17xx__40xx__emac_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">lpc17xx_40xx_emac.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lpc17xx__40xx__emac_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * @brief LPC17xx/40xx LWIP EMAC driver</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * @note</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright(C) NXP Semiconductors, 2012</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * All rights reserved.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * @par</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Software that is described herein is for illustrative purposes only</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * which provides customers with programming information regarding the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * LPC products.  This software is supplied &quot;AS IS&quot; without any warranties of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * any kind, and NXP Semiconductors and its licensor disclaim any and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * all warranties, express or implied, including all implied warranties of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * merchantability, fitness for a particular purpose and non-infringement of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * intellectual property rights.  NXP Semiconductors assumes no responsibility</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * or liability for the use of the software, conveys no license or rights under any</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * patent, copyright, mask work right, or any other intellectual property rights in</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * or to any products. NXP Semiconductors reserves the right to make changes</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * in the software without notification. NXP Semiconductors also makes no</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * representation or warranty that such application will be suitable for the</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * specified use without further testing or modification.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * @par</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * Permission to use, copy, modify, and distribute this software and its</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * documentation is hereby granted, under NXP Semiconductors&#39; and its</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * licensor&#39;s relevant copyrights in the software, without fee, provided that it</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * is used in conjunction with NXP Semiconductors microcontrollers.  This</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * copyright, permission, and disclaimer notice must appear in all copies of</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * this code.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;lwip/opt.h&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;lwip/sys.h&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;lwip/def.h&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;lwip/mem.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;lwip/pbuf.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;lwip/stats.h&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;lwip/snmp.h&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;netif/etharp.h&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;netif/ppp_oe.h&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;lpc_17xx40xx_emac_config.h&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lpc17xx__40xx__emac_8h.html">lpc17xx_40xx_emac.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;chip.h&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;board.h&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lpc__phy_8h.html">lpc_phy.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___e_x_a_m_p_l_e___d_u_a_l_c_o_r_e___e_m_w_i_n.html#ga58eb6f588c4e2c301ca11513b7d66279" title="Delay function.">msDelay</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> ms);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#if LPC_NUM_BUFF_TXDESCS &lt; 2</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#error LPC_NUM_BUFF_TXDESCS must be at least 2</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#if LPC_NUM_BUFF_RXDESCS &lt; 3</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#error LPC_NUM_BUFF_RXDESCS must be at least 3</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/*****************************************************************************</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> * Private types/enumerations/variables</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> ****************************************************************************/</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga7f1979c8d01388e3d590f5f848d5f914">   76</a></span>&#160;<span class="preprocessor">#define tskRECPKT_PRIORITY   (DEFAULT_THREAD_PRIO + 4)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gae109a4acbbfeacd29876bcb30c336cfa">   77</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define tskTXCLEAN_PRIORITY  (DEFAULT_THREAD_PRIO + 5)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor"></span><span class="comment">// #define tskTXCLEAN_PRIORITY  (TCPIP_THREAD_PRIO - 1) // FIXME</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">// #define tskRECPKT_PRIORITY   (TCPIP_THREAD_PRIO - 1) // FIXME</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// #define LOCK_RX_THREAD</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaddaf654c46578cbe517a81a4cc363851">   94</a></span>&#160;<span class="preprocessor">#define RXINTGROUP (ENET_INT_RXOVERRUN | ENET_INT_RXERROR | ENET_INT_RXDONE)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaee927ec597a6522639a70e4f27fbcafd">   98</a></span>&#160;<span class="preprocessor">#define TXINTGROUP (ENET_INT_TXUNDERRUN | ENET_INT_TXERROR | ENET_INT_TXDONE)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define RXINTGROUP 0</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TXINTGROUP 0</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">/* LPC EMAC driver data structure */</span></div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html">  105</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; <span class="comment">/* prxs must be 8 byte aligned! */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">  107</a></span>&#160; <a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html" title="RX Status structure.">ENET_RXSTAT_T</a> prxs[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>]; </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#ae0ec93c5c1e820406466f1845f327eb3">  108</a></span>&#160; <a class="code" href="struct_i_p___e_n_e_t__002___r_x_d_e_s_c___t.html" title="RX Descriptor structure.">ENET_RXDESC_T</a> prxd[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>]; </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a45dfdb1ae1bfee75d531d45fd31211cd">  109</a></span>&#160; <a class="code" href="struct_i_p___e_n_e_t__002___t_x_s_t_a_t___t.html" title="TX Status structure.">ENET_TXSTAT_T</a> ptxs[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>]; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">  110</a></span>&#160; <a class="code" href="struct_i_p___e_n_e_t__002___t_x_d_e_s_c___t.html" title="TX Descriptor structure.">ENET_TXDESC_T</a> ptxd[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>]; </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#aba64edd714f9d59c6e87d205739ba0ef">  111</a></span>&#160; <span class="keyword">struct </span>netif *<a class="code" href="structlpc__enetdata__t.html#aba64edd714f9d59c6e87d205739ba0ef">pnetif</a>;      </div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">  113</a></span>&#160; <span class="keyword">struct </span>pbuf *rxb[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>];  </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a65af34247f0de7bcfc4e71f27c294829">  115</a></span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> <a class="code" href="structlpc__enetdata__t.html#a65af34247f0de7bcfc4e71f27c294829">rx_fill_desc_index</a>;     </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">  116</a></span>&#160; <span class="keyword">volatile</span> <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> <a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a>;    </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">  117</a></span>&#160; <span class="keyword">struct </span>pbuf *txb[<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>];  </div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">  119</a></span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> <a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>;      </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a2a1ba2dfc9d7a1db2d8d6bd2d7484382">  121</a></span>&#160;<span class="preprocessor"></span> <a class="code" href="sys__arch_8h.html#aec5d375beb722c2f756b2c312c3f173a">sys_sem_t</a> <a class="code" href="structlpc__enetdata__t.html#a2a1ba2dfc9d7a1db2d8d6bd2d7484382">rx_sem</a>;       </div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a01aef02f4d7a573c2af9261e11f49d94">  122</a></span>&#160; <a class="code" href="sys__arch_8h.html#aec5d375beb722c2f756b2c312c3f173a">sys_sem_t</a> <a class="code" href="structlpc__enetdata__t.html#a01aef02f4d7a573c2af9261e11f49d94">tx_clean_sem</a>;      </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">  123</a></span>&#160; <a class="code" href="sys__arch_8h.html#ad243dbaa27d93d422fae6e54aadca939">sys_mutex_t</a> <a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>;     </div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#af542406d6e69632702c95cd51d20d1c8">  124</a></span>&#160; <a class="code" href="sys__arch_8h.html#ad243dbaa27d93d422fae6e54aadca939">sys_mutex_t</a> <a class="code" href="structlpc__enetdata__t.html#af542406d6e69632702c95cd51d20d1c8">rx_lock_mutex</a>;     </div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="code" href="structlpc__enetdata__t.html#ab9182ab62049c7155db6d3769f548929">  125</a></span>&#160; xSemaphoreHandle <a class="code" href="structlpc__enetdata__t.html#ab9182ab62049c7155db6d3769f548929">xtx_count_sem</a>;    </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor"></span>} <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaf5802492678d02e2a6f794f3e6040046">  131</a></span>&#160;<a class="code" href="cc_8h.html#a5c3720156dd81cfb1f2b2223302cb43c">ALIGNED</a>(8) <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> <a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">/*****************************************************************************</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> * Public types/enumerations/variables</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> ****************************************************************************/</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">/*****************************************************************************</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * Private functions</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> ****************************************************************************/</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">/* Queues a pbuf into the RX descriptor list */</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gae3a4f61d7fc2b178d36751f69be7f931">lpc_rxqueue_pbuf</a>(<a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif, struct pbuf *p)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> idx;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; <span class="comment">/* Get next free descriptor index */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; idx = lpc_enetif-&gt;rx_fill_desc_index;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; <span class="comment">/* Setup descriptor and clear statuses */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; lpc_enetif-&gt;prxd[idx].Control = <a class="code" href="group___i_p___e_n_e_t__002.html#ga12ee900d60382c12ef287bc722a2047a">ENET_RCTRL_INT</a> | ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) <a class="code" href="group___i_p___e_n_e_t__002.html#gaeae1e7c66c6db99741e78b73aed044fa" title="RX Descriptor Control structure type definition.">ENET_RCTRL_SIZE</a>(p-&gt;len));</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; lpc_enetif-&gt;prxd[idx].Packet = (<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) p-&gt;payload;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; lpc_enetif-&gt;prxs[idx].StatusInfo = 0xFFFFFFFF;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; lpc_enetif-&gt;prxs[idx].StatusHashCRC = 0xFFFFFFFF;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; <span class="comment">/* Save pbuf pointer for push to network layer later */</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; lpc_enetif-&gt;rxb[idx] = p;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; <span class="comment">/* Wrap at end of descriptor list */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; idx++;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; if (idx &gt;= <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  idx = 0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; <span class="comment">/* Queue descriptor(s) */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; lpc_enetif-&gt;rx_free_descs -= 1;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; lpc_enetif-&gt;rx_fill_desc_index = idx;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    (<span class="stringliteral">&quot;lpc_rxqueue_pbuf: pbuf packet queued: %p (free desc=%d)\n&quot;</span>, p,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;     lpc_enetif-&gt;rx_free_descs));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">/* Sets up the RX descriptor ring buffers. */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gad9647014d52f81fdbdd8f0a9d795a6b0">  174</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gad9647014d52f81fdbdd8f0a9d795a6b0">lpc_rx_setup</a>(<a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; <span class="comment">/* Setup pointers to RX structures */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gad2a4f080b6e1a72d75b3a7f9db06f68a" title="Configures the initial ethernet receive descriptors.">Chip_ENET_InitRxDescriptors</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#ae0ec93c5c1e820406466f1845f327eb3">prxd</a>, lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>, <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a> = <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a65af34247f0de7bcfc4e71f27c294829">rx_fill_desc_index</a> = 0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; <span class="comment">/* Build RX buffer and descriptors */</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4ba55f2edd1a20e249e8368af3e2c108" title="Attempt to allocate and requeue a new pbuf for RX.">lpc_rx_queue</a>(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aba64edd714f9d59c6e87d205739ba0ef">pnetif</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; <span class="keywordflow">return</span> ERR_OK;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">/* Allocates a pbuf and returns the data from the incoming packet */</span></div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga06b5409486d34c20e31ba3a4cf88846f">  189</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <span class="keyword">struct </span>pbuf *<a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga06b5409486d34c20e31ba3a4cf88846f">lpc_low_level_input</a>(<span class="keyword">struct</span> netif *netif) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = netif-&gt;state;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; <span class="keyword">struct </span>pbuf *p = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> idx, length;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="preprocessor">#ifdef LOCK_RX_THREAD</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Get exclusive access */</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#a750e00fde4c08e8e6c197f640ab962de">sys_mutex_lock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#af542406d6e69632702c95cd51d20d1c8">rx_lock_mutex</a>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; <span class="comment">/* Monitor RX overrun status. This should never happen unless</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    (possibly) the internal bus is behing held up by something.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    Unless your system is running at a very low clock speed or</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">    there are possibilities that the internal buses may be held</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">    up for a long time, this can probably safely be removed. */</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga5931404e2db29a1b4cdf357edf79504d" title="Get the interrupt status.">Chip_ENET_GetIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>) &amp; <a class="code" href="group___i_p___e_n_e_t__002.html#ga037e3a6511ff23e15616f883f73e79d3" title="Interrupt Status/Enable/Clear/Set Register bit definitions.">ENET_INT_RXOVERRUN</a>) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  LINK_STATS_INC(link.err);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  LINK_STATS_INC(link.drop);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">/* Temporarily disable RX */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gaef60a4790dcce43254081ea7fe5a22d4" title="Disables ethernet packet reception.">Chip_ENET_RXDisable</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">/* Reset the RX side */</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gaddd915f4c5b177bef0cd29d882ed3e6f" title="Reset Rx Logic.">Chip_ENET_ResetRXLogic</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga0a574e2cc8946c200d71152722ac30d7" title="Clear the interrupt status.">Chip_ENET_ClearIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, ENET_INT_RXOVERRUN);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">/* De-allocate all queued RX pbufs */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#a56f62ec1c6e27da3371259b8f2928b30">LPC_NUM_BUFF_RXDESCS</a>; idx++) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx] != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    pbuf_free(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx]);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">/* Start RX side again */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gad9647014d52f81fdbdd8f0a9d795a6b0">lpc_rx_setup</a>(lpc_enetif);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">/* Re-enable RX */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gaccc601f3393807fe6255771fb1c47a0b" title="Enables ethernet packet reception.">Chip_ENET_RXEnable</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">#ifdef LOCK_RX_THREAD</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor"></span>  <a class="code" href="sys__arch__freertos_8c.html#a14b760be89dafa1988ab14d6a4a4d591">sys_mutex_unlock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#af542406d6e69632702c95cd51d20d1c8">rx_lock_mutex</a>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; <span class="comment">/* Determine if a frame has been received */</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; length = 0;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; idx = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gae79ff7cdffb9e43c95fb309ca7c16aa2" title="Get the current Rx Consume Descriptor Index.">Chip_ENET_GetRXConsumeIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; <span class="keywordflow">if</span> (!<a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga19412cfa444b976f9ec13554da17d210" title="Check if Rx buffer is empty.">Chip_ENET_IsRxEmpty</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>)) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">/* Handle errors */</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a> &amp; (<a class="code" href="group___i_p___e_n_e_t__002.html#gad7ea1586c49309069d1d72a4ebe5aa89">ENET_RINFO_CRC_ERR</a> |</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <a class="code" href="group___i_p___e_n_e_t__002.html#ga6c8d6c27397230acdab0d86aae333adb">ENET_RINFO_SYM_ERR</a> | <a class="code" href="group___i_p___e_n_e_t__002.html#ga4e4fcb457d4d1a16900c13f7a5a2db46">ENET_RINFO_ALIGN_ERR</a> | <a class="code" href="group___i_p___e_n_e_t__002.html#ga9a8b65ee2091950cb6a66c2cf2f8be79">ENET_RINFO_LEN_ERR</a>)) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#if LINK_STATS</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor"></span>   <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a> &amp; (<a class="code" href="group___i_p___e_n_e_t__002.html#gad7ea1586c49309069d1d72a4ebe5aa89">ENET_RINFO_CRC_ERR</a> |</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;             <a class="code" href="group___i_p___e_n_e_t__002.html#ga6c8d6c27397230acdab0d86aae333adb">ENET_RINFO_SYM_ERR</a> | <a class="code" href="group___i_p___e_n_e_t__002.html#ga4e4fcb457d4d1a16900c13f7a5a2db46">ENET_RINFO_ALIGN_ERR</a>)) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    LINK_STATS_INC(link.chkerr);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a> &amp; <a class="code" href="group___i_p___e_n_e_t__002.html#ga9a8b65ee2091950cb6a66c2cf2f8be79">ENET_RINFO_LEN_ERR</a>) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    LINK_STATS_INC(link.lenerr);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <span class="comment">/* Drop the frame */</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   LINK_STATS_INC(link.drop);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="comment">/* Re-queue the pbuf for receive */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a>++;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   p = lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gae3a4f61d7fc2b178d36751f69be7f931">lpc_rxqueue_pbuf</a>(lpc_enetif, p);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      (<span class="stringliteral">&quot;lpc_low_level_input: Packet dropped with errors (0x%x)\n&quot;</span>,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;       lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a>));</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   p = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="comment">/* A packet is waiting, get length */</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   length = <a class="code" href="group___i_p___e_n_e_t__002.html#gafaad5a1eff605c6503d88c256d815ac6">ENET_RINFO_SIZE</a>(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#afeeeecdeb5cb332d91aaf3ce8cb96c61">prxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___r_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a>) - 4; <span class="comment">/* Remove FCS */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="comment">/* Zero-copy */</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   p = lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx];</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   p-&gt;len = (<a class="code" href="cc_8h.html#a77570ac4fcab86864fa1916e55676da2">u16_t</a>) length;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="comment">/* Free pbuf from desriptor */</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1d78845ff2b65a4c3e202e1ab1f77bf3">rxb</a>[idx] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a>++;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="comment">/* Queue new buffer(s) */</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4ba55f2edd1a20e249e8368af3e2c108" title="Attempt to allocate and requeue a new pbuf for RX.">lpc_rx_queue</a>(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aba64edd714f9d59c6e87d205739ba0ef">pnetif</a>) == 0) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">/* Re-queue the pbuf for receive */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gae3a4f61d7fc2b178d36751f69be7f931">lpc_rxqueue_pbuf</a>(lpc_enetif, p);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">/* Drop the frame */</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    LINK_STATS_INC(link.drop);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;       (<span class="stringliteral">&quot;lpc_low_level_input: Packet dropped since it could not allocate Rx Buffer\n&quot;</span>));</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    p = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;       (<span class="stringliteral">&quot;lpc_low_level_input: Packet received: %p, size %d (index=%d)\n&quot;</span>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        p, length, idx));</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">/* Save size */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    p-&gt;tot_len = (<a class="code" href="cc_8h.html#a77570ac4fcab86864fa1916e55676da2">u16_t</a>) length;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    LINK_STATS_INC(link.recv);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">/* Update Consume index */</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga3f685f72a474abf5dd77c4bff437ada5" title="Increase the current Rx Consume Descriptor Index.">Chip_ENET_IncRXConsumeIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#ifdef LOCK_RX_THREAD</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor"></span> <a class="code" href="sys__arch__freertos_8c.html#a14b760be89dafa1988ab14d6a4a4d591">sys_mutex_unlock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#af542406d6e69632702c95cd51d20d1c8">rx_lock_mutex</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; <span class="keywordflow">return</span> p;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">/* Determine if the passed address is usable for the ethernet DMA controller */</span></div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga953245b39f7e332832aef7e5763da619">  324</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga953245b39f7e332832aef7e5763da619">lpc_packet_addr_notsafe</a>(<span class="keywordtype">void</span> *addr) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">#if defined(CHIP_LPC175X_6X)</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Check for legal address ranges */</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; <span class="keywordflow">if</span> ((((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &gt;= 0x10000000) &amp;&amp; ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &lt; 0x10008000)) <span class="comment">/* 32kB local SRAM */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  || (((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &gt;= 0x1FFF0000) &amp;&amp; ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &lt; 0x1FFF2000)) <span class="comment">/* 8kB ROM */</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  || (((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &gt;= 0x2007C000) &amp;&amp; ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &lt; 0x20084000)) <span class="comment">/* 32kB AHB SRAM */</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  ) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Check for legal address ranges */</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; <span class="keywordflow">if</span> ((((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &gt;= 0x20000000) &amp;&amp; ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &lt; 0x20008000)) ||</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  (((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &gt;= 0x80000000) &amp;&amp; ((<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) addr &lt; 0xF0000000))) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#endif </span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">/* Sets up the TX descriptor ring buffers */</span></div>
<div class="line"><a name="l00345"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa60152e3f9cd21b46c3fb2f16530e462">  345</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa60152e3f9cd21b46c3fb2f16530e462">lpc_tx_setup</a>(<a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; <a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> idx;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; <span class="comment">/* Build TX descriptors for local buffers */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>; idx++) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">ptxd</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___t_x_d_e_s_c___t.html#a08b46e8e765e946c0ce972fac6d0a702">Control</a> = 0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a45dfdb1ae1bfee75d531d45fd31211cd">ptxs</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___t_x_s_t_a_t___t.html#a74d784d661228bc19444f6eaf00401de">StatusInfo</a> = 0xFFFFFFFF;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; <span class="comment">/* Setup pointers to TX structures */</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gad95d875208116ce258a479818919a819" title="Configures the initial ethernet transmit descriptors.">Chip_ENET_InitTxDescriptors</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">ptxd</a>, lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a45dfdb1ae1bfee75d531d45fd31211cd">ptxs</a>, LPC_NUM_BUFF_TXDESCS);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a> = 0;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; <span class="keywordflow">return</span> ERR_OK;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">/* Free TX buffers that are complete */</span></div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gafdef671c024c6de5ad8478ec960011f9">  364</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gafdef671c024c6de5ad8478ec960011f9">lpc_tx_reclaim_st</a>(<a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif, <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> cidx)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Get exclusive access */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#a750e00fde4c08e8e6c197f640ab962de">sys_mutex_lock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; <span class="keywordflow">while</span> (cidx != lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>] != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      (<span class="stringliteral">&quot;lpc_tx_reclaim_st: Freeing packet %p (index %d)\n&quot;</span>,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;       lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>],</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;       lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>));</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   pbuf_free(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>]);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor"></span>  xSemaphoreGive(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#ab9182ab62049c7155db6d3769f548929">xtx_count_sem</a>);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor"></span>  lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a>++;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a> &gt;= <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>) {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a57c2364dfda77b65be66eef61b968dfc">lpc_last_tx_idx</a> = 0;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Restore access */</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#a14b760be89dafa1988ab14d6a4a4d591">sys_mutex_unlock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">/* Low level output of a packet. Never call this from an interrupt context,</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"> * as it may block until TX descriptors become available. */</span></div>
<div class="line"><a name="l00398"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gac84c8e61ecde3ed1e4aa421984f7d6ed">  398</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gac84c8e61ecde3ed1e4aa421984f7d6ed">lpc_low_level_output</a>(<span class="keyword">struct</span> netif *netif, <span class="keyword">struct</span> pbuf *p)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = netif-&gt;state;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; <span class="keyword">struct </span>pbuf *q;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">#if LPC_TX_PBUF_BOUNCE_EN == 1</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="preprocessor"></span> <a class="code" href="group___n_e_t___l_w_i_p___a_r_c_h.html#ga4caecabca98b43919dd11be1c0d4cd8e">u8_t</a> *dst;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; <span class="keyword">struct </span>pbuf *np;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="preprocessor"></span> <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> idx;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> dn, notdmasafe = 0;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; <span class="comment">/* Zero-copy TX buffers may be fragmented across mutliple payload</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">    chains. Determine the number of descriptors needed for the</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">    transfer. The pbuf chaining can be a mess! */</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; dn = (<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) pbuf_clen(p);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; <span class="comment">/* Test to make sure packet addresses are DMA safe. A DMA safe</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">    address is once that uses external memory or periphheral RAM.</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">    IRAM and FLASH are not safe! */</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; <span class="keywordflow">for</span> (q = p; q != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; q = q-&gt;next) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  notdmasafe += <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga953245b39f7e332832aef7e5763da619">lpc_packet_addr_notsafe</a>(q-&gt;payload);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#if LPC_TX_PBUF_BOUNCE_EN == 1</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor"></span> <span class="comment">/* If the pbuf is not DMA safe, a new bounce buffer (pbuf) will be</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">    created that will be used instead. This requires an copy from the</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">    non-safe DMA region to the new pbuf */</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; <span class="keywordflow">if</span> (notdmasafe) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">/* Allocate a pbuf in DMA memory */</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  np = pbuf_alloc(PBUF_RAW, p-&gt;tot_len, PBUF_RAM);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">if</span> (np == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      (<span class="stringliteral">&quot;lpc_low_level_output: could not allocate TX pbuf\n&quot;</span>));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="keywordflow">return</span> ERR_MEM;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">/* This buffer better be contiguous! */</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  LWIP_ASSERT(<span class="stringliteral">&quot;lpc_low_level_output: New transmit pbuf is chained&quot;</span>,</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;     (pbuf_clen(np) == 1));</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="comment">/* Copy to DMA safe pbuf */</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  dst = (<a class="code" href="group___n_e_t___l_w_i_p___a_r_c_h.html#ga4caecabca98b43919dd11be1c0d4cd8e">u8_t</a> *) np-&gt;payload;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  for (q = p; q != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; q = q-&gt;next) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="comment">/* Copy the buffer to the descriptor&#39;s buffer */</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   MEMCPY(dst, (<a class="code" href="group___n_e_t___l_w_i_p___a_r_c_h.html#ga4caecabca98b43919dd11be1c0d4cd8e">u8_t</a> *) q-&gt;payload, q-&gt;len);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   dst += q-&gt;len;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  np-&gt;len = p-&gt;tot_len;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;     (<span class="stringliteral">&quot;lpc_low_level_output: Switched to DMA safe buffer, old=%p, new=%p\n&quot;</span>,</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      q, np));</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">/* use the new buffer for descrptor queueing. The original pbuf will</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">     be de-allocated outsuide this driver. */</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  p = np;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  dn = 1;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">if</span> (notdmasafe) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  LWIP_ASSERT(<span class="stringliteral">&quot;lpc_low_level_output: Not a DMA safe pbuf&quot;</span>,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;     (notdmasafe == 0));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; <span class="comment">/* Wait until enough descriptors are available for the transfer. */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; <span class="comment">/* THIS WILL BLOCK UNTIL THERE ARE ENOUGH DESCRIPTORS AVAILABLE */</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; <span class="keywordflow">while</span> (dn &gt; <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa3b31a7db89ced8ad4a7b92946e5fcf0" title="Polls if an available TX descriptor is ready.">lpc_tx_ready</a>(netif)) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor"></span>  xSemaphoreTake(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#ab9182ab62049c7155db6d3769f548929">xtx_count_sem</a>, 0);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor"></span>  <a class="code" href="group___e_x_a_m_p_l_e___d_u_a_l_c_o_r_e___e_m_w_i_n.html#ga58eb6f588c4e2c301ca11513b7d66279" title="Delay function.">msDelay</a>(1);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor"></span> }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; <span class="comment">/* Get free TX buffer index */</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; idx = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga276d359d20f70fdb005740c3287dd2d7" title="Get the current Tx Produce Descriptor Index.">Chip_ENET_GetTXProduceIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Get exclusive access */</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#a750e00fde4c08e8e6c197f640ab962de">sys_mutex_lock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; <span class="comment">/* Prevent LWIP from de-allocating this pbuf. The driver will</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">    free it once it&#39;s been transmitted. */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; <span class="keywordflow">if</span> (!notdmasafe) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  pbuf_ref(p);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; <span class="comment">/* Setup transfers */</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; q = p;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; <span class="keywordflow">while</span> (dn &gt; 0) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  dn--;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">/* Only save pointer to free on last descriptor */</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (dn == 0) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <span class="comment">/* Save size of packet and signal it&#39;s ready */</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">ptxd</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___t_x_d_e_s_c___t.html#a08b46e8e765e946c0ce972fac6d0a702">Control</a> = <a class="code" href="group___i_p___e_n_e_t__002.html#ga2acf2f4610df8309e83344164ccbc107" title="TX Descriptor Control structure type definition.">ENET_TCTRL_SIZE</a>(q-&gt;len) | <a class="code" href="group___i_p___e_n_e_t__002.html#ga38618011f4bed353ba352c639b511268">ENET_TCTRL_INT</a> |</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;           <a class="code" href="group___i_p___e_n_e_t__002.html#ga77c27155fbe90a33eccb8a4331f1c2b5">ENET_TCTRL_LAST</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[idx] = p;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="comment">/* Save size of packet, descriptor is not last */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">ptxd</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___t_x_d_e_s_c___t.html#a08b46e8e765e946c0ce972fac6d0a702">Control</a> = <a class="code" href="group___i_p___e_n_e_t__002.html#ga2acf2f4610df8309e83344164ccbc107" title="TX Descriptor Control structure type definition.">ENET_TCTRL_SIZE</a>(q-&gt;len) | <a class="code" href="group___i_p___e_n_e_t__002.html#ga38618011f4bed353ba352c639b511268">ENET_TCTRL_INT</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[idx] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;     (<span class="stringliteral">&quot;lpc_low_level_output: pbuf packet(%p) sent, chain#=%d,&quot;</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="stringliteral">&quot; size = %d (index=%d)\n&quot;</span>, q-&gt;payload, dn, q-&gt;len, idx));</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aa9ce6c69cf9aab83ea237c5418c35de1">ptxd</a>[idx].<a class="code" href="struct_i_p___e_n_e_t__002___t_x_d_e_s_c___t.html#af068a5f8f80955f4fd404b2d32db46c3">Packet</a> = (<a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a>) q-&gt;payload;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  q = q-&gt;next;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  idx = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gaa545fbc25f70c1465d8fecbcb3b88954" title="Increase the current Tx Produce Descriptor Index.">Chip_ENET_IncTXProduceIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; LINK_STATS_INC(link.xmit);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Restore access */</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#a14b760be89dafa1988ab14d6a4a4d591">sys_mutex_unlock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; <span class="keywordflow">return</span> ERR_OK;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;}</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="preprocessor"></span><span class="comment">/* Packet reception task for FreeRTOS */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4e09f0c77b01accafc0ddc22b7318fbc">  529</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4e09f0c77b01accafc0ddc22b7318fbc">portTASK_FUNCTION</a>(vPacketReceiveTask, pvParameters)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;{</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = pvParameters;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">/* Wait for receive task to wakeup */</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="sys__arch__freertos_8c.html#aa3b281873541363c5a76fb3d19f42489">sys_arch_sem_wait</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a2a1ba2dfc9d7a1db2d8d6bd2d7484382">rx_sem</a>, 0);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="comment">/* Process packets until all empty */</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga19412cfa444b976f9ec13554da17d210" title="Check if Rx buffer is empty.">Chip_ENET_IsRxEmpty</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>)) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga801c555f743ecbc0d6cc035999128317" title="Attempt to read a packet from the EMAC interface.">lpc_enetif_input</a>(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#aba64edd714f9d59c6e87d205739ba0ef">pnetif</a>);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">/* Transmit cleanup task for FreeRTOS */</span></div>
<div class="line"><a name="l00545"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gad1e9eb3e84b774b70390217cb18c138f">  545</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4e09f0c77b01accafc0ddc22b7318fbc">portTASK_FUNCTION</a>(vTransmitCleanupTask, pvParameters)</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;{</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = pvParameters;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; <a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> idx;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">/* Wait for transmit cleanup task to wakeup */</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <a class="code" href="sys__arch__freertos_8c.html#aa3b281873541363c5a76fb3d19f42489">sys_arch_sem_wait</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a01aef02f4d7a573c2af9261e11f49d94">tx_clean_sem</a>, 0);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">/* Error handling for TX underruns. This should never happen unless</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">     something is holding the bus or the clocks are going too slow. It</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">     can probably be safely removed. */</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga5931404e2db29a1b4cdf357edf79504d" title="Get the interrupt status.">Chip_ENET_GetIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>) &amp; <a class="code" href="group___i_p___e_n_e_t__002.html#gae41a8df58ad75321ba10799774141411">ENET_INT_TXUNDERRUN</a>) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   LINK_STATS_INC(link.err);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   LINK_STATS_INC(link.drop);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="preprocessor"></span>   <span class="comment">/* Get exclusive access */</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <a class="code" href="sys__arch__freertos_8c.html#a750e00fde4c08e8e6c197f640ab962de">sys_mutex_lock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="preprocessor"></span>   <span class="comment">/* Reset the TX side */</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga23cc17a06ee9e42b4f1327cd792a2a8e" title="Reset Tx Logic.">Chip_ENET_ResetTXLogic</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga0a574e2cc8946c200d71152722ac30d7" title="Clear the interrupt status.">Chip_ENET_ClearIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, ENET_INT_TXUNDERRUN);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="comment">/* De-allocate all queued TX pbufs */</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>; idx++) {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[idx] != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;     pbuf_free(lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[idx]);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;     lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a3366ea8d1a24ab78926514f507d3e10e">txb</a>[idx] = <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor"></span>   <span class="comment">/* Restore access */</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   <a class="code" href="sys__arch__freertos_8c.html#a14b760be89dafa1988ab14d6a4a4d591">sys_mutex_unlock</a>(&amp;lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a1df375fcebd26590e51ed4feb9f5468a">tx_lock_mutex</a>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor"></span>   <span class="comment">/* Start TX side again */</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa60152e3f9cd21b46c3fb2f16530e462">lpc_tx_setup</a>(lpc_enetif);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="comment">/* Free TX buffers that are done sending */</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga92f13936ed5b9c060a139612c5e37b71" title="Call for freeing TX buffers that are complete.">lpc_tx_reclaim</a>(<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.pnetif);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/* Low level init of the MAC and PHY */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaf95c7eb71c7ea0403e74ef77ef997862">  594</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaf95c7eb71c7ea0403e74ef77ef997862">low_level_init</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = netif-&gt;state;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; err_t err = ERR_OK;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga0422387607fd22260c97f6444a95ecc8" title="Initialize ethernet interface.">Chip_ENET_Init</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; <span class="comment">/* Initialize the PHY */</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga11dcb6545d985ab495c69e58d9c95e2c" title="Sets up the PHY link clock divider and PHY address.">Chip_ENET_SetupMII</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gad107338dec5ee221957fafe5e711e42e" title="Find the divider index for a desired MII clock rate.">Chip_ENET_FindMIIDiv</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, 2500000), <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ad733ddd22d8d85b309035d232a57be06">LPC_PHYDEF_PHYADDR</a>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="preprocessor">#if defined(USE_RMII)</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">if</span> (<a class="code" href="group___b_o_a_r_d___p_h_y.html#ga9d09c9f5e31d5213b738ab80863776d5" title="Initialize the PHY.">lpc_phy_init</a>(<span class="keyword">true</span>, <a class="code" href="group___e_x_a_m_p_l_e___d_u_a_l_c_o_r_e___e_m_w_i_n.html#ga58eb6f588c4e2c301ca11513b7d66279" title="Delay function.">msDelay</a>) != <a class="code" href="group___l_p_c___types___public___types.html#gga67a0db04d321a74b7e7fcfd3f1a3f70bac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>) {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba2fd6f336d08340583bd620a7f5694c90">ERROR</a>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">if</span> (<a class="code" href="group___b_o_a_r_d___p_h_y.html#ga9d09c9f5e31d5213b738ab80863776d5" title="Initialize the PHY.">lpc_phy_init</a>(<span class="keyword">false</span>, <a class="code" href="group___e_x_a_m_p_l_e___d_u_a_l_c_o_r_e___e_m_w_i_n.html#ga58eb6f588c4e2c301ca11513b7d66279" title="Delay function.">msDelay</a>) != <a class="code" href="group___l_p_c___types___public___types.html#gga67a0db04d321a74b7e7fcfd3f1a3f70bac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gga67a0db04d321a74b7e7fcfd3f1a3f70ba2fd6f336d08340583bd620a7f5694c90">ERROR</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; <span class="comment">/* Save station address */</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga6d915db1de0ba98ac0cdb1df8c59515b" title="Sets the address of the interface.">Chip_ENET_SetADDR</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, netif-&gt;hwaddr);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; <span class="comment">/* Setup transmit and receive descriptors */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa60152e3f9cd21b46c3fb2f16530e462">lpc_tx_setup</a>(lpc_enetif) != ERR_OK) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">return</span> ERR_BUF;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gad9647014d52f81fdbdd8f0a9d795a6b0">lpc_rx_setup</a>(lpc_enetif) != ERR_OK) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordflow">return</span> ERR_BUF;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; <span class="comment">/* Enable packet reception */</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="preprocessor">#if IP_SOF_BROADCAST_RECV</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="preprocessor"></span> <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga87335faab88d9a16579596f4a0a6ce14" title="Enable Rx Filter.">Chip_ENET_EnableRXFilter</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, <a class="code" href="group___i_p___e_n_e_t__002.html#ga86aaaa49bc70fe343262a4373c056c87">ENET_RXFILTERCTRL_APE</a> | <a class="code" href="group___i_p___e_n_e_t__002.html#gaa63bf71c0439dc5176b4af167f4c7f75">ENET_RXFILTERCTRL_ABE</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="preprocessor"></span> <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga87335faab88d9a16579596f4a0a6ce14" title="Enable Rx Filter.">Chip_ENET_EnableRXFilter</a>(<a class="code" href="group___i_p___e_n_e_t__002.html#ga86aaaa49bc70fe343262a4373c056c87">ENET_RXFILTERCTRL_APE</a>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; <span class="comment">/* Clear and enable rx/tx interrupts */</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gac0afbb3c822a9e581416fd500b922313" title="Enable ENET interrupts.">Chip_ENET_EnableInt</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaddaf654c46578cbe517a81a4cc363851" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">RXINTGROUP</a> | <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaee927ec597a6522639a70e4f27fbcafd" title="Transmit group interrupts.">TXINTGROUP</a>);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; <span class="comment">/* Enable RX and TX */</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gacc7e455d4b168d2405b4ef9dda242488" title="Enables ethernet transmit.">Chip_ENET_TXEnable</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gaccc601f3393807fe6255771fb1c47a0b" title="Enables ethernet packet reception.">Chip_ENET_RXEnable</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">/* This function is the ethernet packet send function. It calls</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"> * etharp_output after checking link status. */</span></div>
<div class="line"><a name="l00643"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga178daa0a0c7a49d0383aa7c1520c5ab3">  643</a></span>&#160;<a class="code" href="group___l_p_c___types___public___macros.html#ga10b2d890d871e1489bb02b7e70d9bdfb">STATIC</a> err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga178daa0a0c7a49d0383aa7c1520c5ab3">lpc_etharp_output</a>(<span class="keyword">struct</span> netif *netif, <span class="keyword">struct</span> pbuf *q,</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          ip_addr_t *ipaddr)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;{</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; <span class="comment">/* Only send packet is link is up */</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; <span class="keywordflow">if</span> (netif-&gt;flags &amp; NETIF_FLAG_LINK_UP) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">return</span> etharp_output(netif, q, ipaddr);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; <span class="keywordflow">return</span> ERR_CONN;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">/*****************************************************************************</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"> * Public functions</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"> ****************************************************************************/</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">/* Attempt to allocate and requeue a new pbuf for RX */</span></div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4ba55f2edd1a20e249e8368af3e2c108">  658</a></span>&#160;<a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga4ba55f2edd1a20e249e8368af3e2c108" title="Attempt to allocate and requeue a new pbuf for RX.">lpc_rx_queue</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;{</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; <a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *lpc_enetif = netif-&gt;state;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; <span class="keyword">struct </span>pbuf *p;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; <a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> queued = 0;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; <span class="comment">/* Attempt to requeue as many packets as possible */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; <span class="keywordflow">while</span> (lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a> &gt; 0) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">/* Allocate a pbuf from the pool. We need to allocate at the</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">     maximum size as we don&#39;t know the size of the yet to be</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">     received packet. */</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  p = pbuf_alloc(PBUF_RAW, (<a class="code" href="cc_8h.html#a77570ac4fcab86864fa1916e55676da2">u16_t</a>) <a class="code" href="group___i_p___e_n_e_t__002.html#gacba3b6d78224fc1ee628088edbff5609" title="Maximum size of an ethernet buffer.">ENET_ETH_MAX_FLEN</a>, PBUF_RAM);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">if</span> (p == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   LWIP_DEBUGF(<a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a3f45d147e071ba697c672065061ca0b3">EMAC_DEBUG</a> | LWIP_DBG_TRACE,</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      (<span class="stringliteral">&quot;lpc_rx_queue: could not allocate RX pbuf (free desc=%d)\n&quot;</span>,</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;       lpc_enetif-&gt;<a class="code" href="structlpc__enetdata__t.html#a87eba116a49fa3b7ddb29d569b5873a0">rx_free_descs</a>));</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="keywordflow">return</span> queued;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">/* pbufs allocated from the RAM pool should be non-chained. */</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  LWIP_ASSERT(<span class="stringliteral">&quot;lpc_rx_queue: pbuf is not contiguous (chained)&quot;</span>,</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;     pbuf_clen(p) &lt;= 1);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">/* Queue packet */</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gae3a4f61d7fc2b178d36751f69be7f931">lpc_rxqueue_pbuf</a>(lpc_enetif, p);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">/* Update queued count */</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  queued++;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; <span class="keywordflow">return</span> queued;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;}</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">/* Attempt to read a packet from the EMAC interface */</span></div>
<div class="line"><a name="l00693"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#ga801c555f743ecbc0d6cc035999128317">  693</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga801c555f743ecbc0d6cc035999128317" title="Attempt to read a packet from the EMAC interface.">lpc_enetif_input</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; <span class="keyword">struct </span>eth_hdr *ethhdr;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; <span class="keyword">struct </span>pbuf *p;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; <span class="comment">/* move received packet into a new pbuf */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; p = <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga06b5409486d34c20e31ba3a4cf88846f">lpc_low_level_input</a>(netif);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; <span class="keywordflow">if</span> (p == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; <span class="comment">/* points to packet payload, which starts with an Ethernet header */</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; ethhdr = p-&gt;payload;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; <span class="keywordflow">switch</span> (htons(ethhdr-&gt;type)) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; <span class="keywordflow">case</span> ETHTYPE_IP:</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; <span class="keywordflow">case</span> ETHTYPE_ARP:</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="preprocessor">#if PPPOE_SUPPORT</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">case</span> ETHTYPE_PPPOEDISC:</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; <span class="keywordflow">case</span> ETHTYPE_PPPOE:</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* PPPOE_SUPPORT */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="preprocessor"></span>  <span class="comment">/* full packet send to tcpip_thread to process */</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">if</span> (netif-&gt;input(p, netif) != ERR_OK) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   LWIP_DEBUGF(NETIF_DEBUG, (<span class="stringliteral">&quot;lpc_enetif_input: IP input error\n&quot;</span>));</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="comment">/* Free buffer */</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   pbuf_free(p);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">/* Return buffer */</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  pbuf_free(p);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;}</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">/* Call for freeing TX buffers that are complete */</span></div>
<div class="line"><a name="l00731"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#ga92f13936ed5b9c060a139612c5e37b71">  731</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga92f13936ed5b9c060a139612c5e37b71" title="Call for freeing TX buffers that are complete.">lpc_tx_reclaim</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;{</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gafdef671c024c6de5ad8478ec960011f9">lpc_tx_reclaim_st</a>((<a class="code" href="structlpc__enetdata__t.html">lpc_enetdata_t</a> *) netif-&gt;state,</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;       <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga6ed1ce4f6bde22c64966d2d513cc7a6d" title="Get the current Tx Consume Descriptor Index.">Chip_ENET_GetTXConsumeIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>));</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;}</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">/* Polls if an available TX descriptor is ready */</span></div>
<div class="line"><a name="l00738"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa3b31a7db89ced8ad4a7b92946e5fcf0">  738</a></span>&#160;<a class="code" href="cc_8h.html#a10f9a3d7baef58ccc23228c3bd29c1fb">s32_t</a> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa3b31a7db89ced8ad4a7b92946e5fcf0" title="Polls if an available TX descriptor is ready.">lpc_tx_ready</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;{</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; <a class="code" href="cc_8h.html#a4c14294869aceba3ef9d4c0c302d0f33">u32_t</a> pidx, cidx;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; cidx = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga6ed1ce4f6bde22c64966d2d513cc7a6d" title="Get the current Tx Consume Descriptor Index.">Chip_ENET_GetTXConsumeIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; pidx = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga276d359d20f70fdb005740c3287dd2d7" title="Get the current Tx Produce Descriptor Index.">Chip_ENET_GetTXProduceIndex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga4d0afde7abd542590c1bb53fba4d90b1" title="Get the number of free descriptors.">Chip_ENET_GetFreeDescNum</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, pidx, cidx, <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gabc33835371e2d879b7a3ef000ccc9eef">  754</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gabc33835371e2d879b7a3ef000ccc9eef" title="EMAC interrupt handler.">ETH_IRQHandler</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;{</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="preprocessor">#if NO_SYS == 1</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Interrupts are not used without an RTOS */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; NVIC_DisableIRQ(ETHERNET_IRQn);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="preprocessor"></span> <span class="keywordtype">signed</span> portBASE_TYPE xRecTaskWoken = pdFALSE, XTXTaskWoken = pdFALSE;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> ints;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; <span class="comment">/* Interrupts are of 2 groups - transmit or receive. Based on the</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">    interrupt, kick off the receive or transmit (cleanup) task */</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; <span class="comment">/* Get pending interrupts */</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; ints = <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga5931404e2db29a1b4cdf357edf79504d" title="Get the interrupt status.">Chip_ENET_GetIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; <span class="keywordflow">if</span> (ints &amp; <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaddaf654c46578cbe517a81a4cc363851" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">RXINTGROUP</a>) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">/* RX group interrupt(s) */</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">/* Give semaphore to wakeup RX receive task. Note the FreeRTOS</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">     method is used instead of the LWIP arch method. */</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  xSemaphoreGiveFromISR(<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.rx_sem, &amp;xRecTaskWoken);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; <span class="keywordflow">if</span> (ints &amp; <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaee927ec597a6522639a70e4f27fbcafd" title="Transmit group interrupts.">TXINTGROUP</a>) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">/* TX group interrupt(s) */</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="comment">/* Give semaphore to wakeup TX cleanup task. Note the FreeRTOS</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">     method is used instead of the LWIP arch method. */</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  xSemaphoreGiveFromISR(<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.tx_clean_sem, &amp;XTXTaskWoken);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; <span class="comment">/* Clear pending interrupts */</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga0a574e2cc8946c200d71152722ac30d7" title="Clear the interrupt status.">Chip_ENET_ClearIntStatus</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>, ints);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; <span class="comment">/* Context switch needed? */</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; portEND_SWITCHING_ISR(xRecTaskWoken || XTXTaskWoken);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">/* Set up the MAC interface duplex */</span></div>
<div class="line"><a name="l00792"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gadea1cbac6c71cba322ac7d9bded78133">  792</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gadea1cbac6c71cba322ac7d9bded78133" title="Set up the MAC interface duplex.">lpc_emac_set_duplex</a>(<span class="keywordtype">int</span> full_duplex)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;{</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; <span class="keywordflow">if</span> (full_duplex) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga9062d2664905ae0e542b7001a209c7c6" title="Sets full duplex operation for the interface.">Chip_ENET_SetFullDuplex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gad9aabcb9f57fb1a1c6ea754604c27d3f" title="Sets half duplex operation for the interface.">Chip_ENET_SetHalfDuplex</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;}</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">/* Set up the MAC interface speed */</span></div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gac87e13debd8883d5629f68064f1940a7">  803</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gac87e13debd8883d5629f68064f1940a7" title="Set up the MAC interface speed.">lpc_emac_set_speed</a>(<span class="keywordtype">int</span> mbs_100)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;{</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; <span class="keywordflow">if</span> (mbs_100) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#gad78db17fecab956142cb20d9a00e39e0" title="Selects 100Mbps for the current speed.">Chip_ENET_Set100Mbps</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <a class="code" href="group___e_n_e_t__17_x_x__40_x_x.html#ga996dae6b7276fc708594ce239f40785f" title="Selects 10Mbps for the current speed.">Chip_ENET_Set10Mbps</a>(<a class="code" href="group___p_e_r_i_p_h__175_x__6_x___b_a_s_e.html#gaddb977e4442891b21ced3344c71440d7">LPC_ETHERNET</a>);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;}</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">/* LWIP 17xx/40xx EMAC initialization function */</span></div>
<div class="line"><a name="l00814"></a><span class="lineno"><a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#ga2bee3a5572867cf8761b3b0e3db6302f">  814</a></span>&#160;err_t <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga2bee3a5572867cf8761b3b0e3db6302f" title="LWIP 17xx/40xx EMAC initialization function.">lpc_enetif_init</a>(<span class="keyword">struct</span> netif *netif)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;{</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; err_t err;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;netif != NULL&quot;</span>, (netif != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; <a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.pnetif = netif;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; <span class="comment">/* set MAC hardware address */</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; <a class="code" href="group___b_o_a_r_d___e_a___d_e_v_k_i_t__17884088.html#ga4e21ba86f42bc4dd53b704a81d923e1d" title="Returns the MAC address assigned to this board.">Board_ENET_GetMacADDR</a>(netif-&gt;hwaddr);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; netif-&gt;hwaddr_len = ETHARP_HWADDR_LEN;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; <span class="comment">/* maximum transfer unit */</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; netif-&gt;mtu = 1500;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; <span class="comment">/* device capabilities */</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; netif-&gt;flags = NETIF_FLAG_BROADCAST | NETIF_FLAG_ETHARP | NETIF_FLAG_UP |</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;       NETIF_FLAG_ETHERNET;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; <span class="comment">/* Initialize the hardware */</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; netif-&gt;state = &amp;<a class="code" href="group___n_e_t___l_w_i_p___l_p_c18_x_x43_x_x___e_m_a_c___d_r_i_v_e_r.html#gaa63720a832da0a4b64c3dcc691553a26">lpc_enetdata</a>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; err = <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gaf95c7eb71c7ea0403e74ef77ef997862">low_level_init</a>(netif);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; <span class="keywordflow">if</span> (err != ERR_OK) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor">#if LWIP_NETIF_HOSTNAME</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor"></span> <span class="comment">/* Initialize interface hostname */</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; netif-&gt;hostname = <span class="stringliteral">&quot;lwiplpc&quot;</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* LWIP_NETIF_HOSTNAME */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; netif-&gt;name[0] = <span class="charliteral">&#39;e&#39;</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160; netif-&gt;name[1] = <span class="charliteral">&#39;n&#39;</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; netif-&gt;output = <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga178daa0a0c7a49d0383aa7c1520c5ab3">lpc_etharp_output</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; netif-&gt;linkoutput = <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gac84c8e61ecde3ed1e4aa421984f7d6ed">lpc_low_level_output</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; <span class="comment">/* For FreeRTOS, start tasks */</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="preprocessor">#if NO_SYS == 0</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor"></span> <a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.xtx_count_sem = xSemaphoreCreateCounting(<a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <a class="code" href="dualcore__43xx_2lwip_2webserver_2configs_2lpc__18xx43xx__emac__config_8h.html#ac0879e19647dfc1192c3d30d8e752039">LPC_NUM_BUFF_TXDESCS</a>);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;xtx_count_sem creation error&quot;</span>,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    (<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.xtx_count_sem != <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; err = <a class="code" href="sys__arch__freertos_8c.html#a5606dbce7b9509ef7366e3c3c818c4eb" title="Create a new mutex.">sys_mutex_new</a>(&amp;<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.tx_lock_mutex);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;tx_lock_mutex creation error&quot;</span>, (err == ERR_OK));</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; err = <a class="code" href="sys__arch__freertos_8c.html#a5606dbce7b9509ef7366e3c3c818c4eb" title="Create a new mutex.">sys_mutex_new</a>(&amp;<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.rx_lock_mutex);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;rx_lock_mutex creation error&quot;</span>, (err == ERR_OK));</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; <span class="comment">/* Packet receive task */</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; err = <a class="code" href="sys__arch__freertos_8c.html#a5d6d7fa35a9b0d102bcb8e08f7dbbd61">sys_sem_new</a>(&amp;<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.rx_sem, 0);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;rx_sem creation error&quot;</span>, (err == ERR_OK));</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#ad6718f1ad9fcd2073d16557b42c24fab">sys_thread_new</a>(<span class="stringliteral">&quot;receive_thread&quot;</span>, vPacketReceiveTask, netif-&gt;state,</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;       <a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a7f93dfeaed4021061959f822def602cb">DEFAULT_THREAD_STACKSIZE</a>, <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#ga7f1979c8d01388e3d590f5f848d5f914" title="Driver transmit and receive thread priorities Thread priorities for receive thread and TX cleanup thr...">tskRECPKT_PRIORITY</a>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; <span class="comment">/* Transmit cleanup task */</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; err = <a class="code" href="sys__arch__freertos_8c.html#a5d6d7fa35a9b0d102bcb8e08f7dbbd61">sys_sem_new</a>(&amp;<a class="code" href="structlpc__enetdata.html" title="Debug output formatter lock define When using FreeRTOS and with LWIP_DEBUG enabled, enabling this define will allow RX debug messages to not interleave with the TX messages (so they are actually readable). Not enabling this define when the system is under load will cause the output to be unreadable. There is a small tradeoff in performance for this so use it only for debug.">lpc_enetdata</a>.tx_clean_sem, 0);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; LWIP_ASSERT(<span class="stringliteral">&quot;tx_clean_sem creation error&quot;</span>, (err == ERR_OK));</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; <a class="code" href="sys__arch__freertos_8c.html#ad6718f1ad9fcd2073d16557b42c24fab">sys_thread_new</a>(<span class="stringliteral">&quot;txclean_thread&quot;</span>, vTransmitCleanupTask, netif-&gt;state,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;       <a class="code" href="lpc18xx__43xx_2examples_2dualcore__43xx_2lwip_2webserver_2configs_2lwipopts_8h.html#a7f93dfeaed4021061959f822def602cb">DEFAULT_THREAD_STACKSIZE</a>, <a class="code" href="group___n_e_t___l_w_i_p___l_p_c17_x_x40_x_x___e_m_a_c___d_r_i_v_e_r.html#gae109a4acbbfeacd29876bcb30c336cfa">tskTXCLEAN_PRIORITY</a>);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; <span class="keywordflow">return</span> ERR_OK;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c8fa76d8dc1b9e06ff8aeb3121608b1b.html">software</a></li><li class="navelem"><a class="el" href="dir_95e1ffccea1a841b097b48c84d23668f.html">lwip</a></li><li class="navelem"><a class="el" href="dir_739f8de5c2517285a7437c7c14258b98.html">lpclwip</a></li><li class="navelem"><a class="el" href="dir_a4fa84d40b64f1bcf13a9261695ba051.html">arch</a></li><li class="navelem"><a class="el" href="lpc17xx__40xx__emac_8c.html">lpc17xx_40xx_emac.c</a></li>
    <li class="footer">Generated on Fri May 10 2013 10:42:24 for LPCOpen Platform by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
