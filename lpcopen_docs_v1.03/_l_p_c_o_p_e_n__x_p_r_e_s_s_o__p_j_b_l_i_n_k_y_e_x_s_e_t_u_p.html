<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LPCOpen Platform: Setting up an Xpresso executable image project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="driver.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LPCOpen Platform
   &#160;<span id="projectnumber">v1.03</span>
   </div>
   <div id="projectbrief">LPCOpen Platform for NXP LPC Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_l_p_c_o_p_e_n__x_p_r_e_s_s_o__p_j_b_l_i_n_k_y_e_x_s_e_t_u_p.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Setting up an Xpresso executable image project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Setting up an Xpresso executable image project</b><br/>
 A simple project will be created that uses another library project.<br/>
</p>
<p><b><em>The example here shows how to build a simple blinky executable image for the Embedded Artists LCP1788 board. This executable uses the Embedded Artists LCP1788 board library.</em></b><br/>
</p>
<p><b>Create a new C project</b><br/>
 Create a new project using the New-&gt;Project selection on the file menu.<br/>
 </p>
<div class="image">
<img src="new_project1.jpg" alt="new_project1.jpg"/>
</div>
<p>Select C/C++-&gt;C project in the new project dialog window and press Next&gt;.<br/>
 </p>
<div class="image">
<img src="new_c_project1.jpg" alt="new_c_project1.jpg"/>
</div>
<p>On the next dialog window, name your project and select the Empty project type. Press Next&gt;.<br/>
 </p>
<div class="image">
<img src="new_c_project2.jpg" alt="new_c_project2.jpg"/>
</div>
<p>On the next dialog window, select the default 'Debug' and 'Release' project configurations. This will create an unoptimized debug configuration and an optimized release configuration of the project. Press Next&gt;.<br/>
</p>
<p>On the next dialog window, select the device your project will use. <em>For this example, we use the LPC1788.</em>. Press Finish.<br/>
 </p>
<div class="image">
<img src="new_project4.jpg" alt="new_project4.jpg"/>
</div>
<p>After pressing Finish, the project is added to the project explorer window. Before adding source files to the project, a few more items specific to the LPCOpen platform need to be configured in the project.<br/>
</p>
<p><b>CORE_M? symbol setup</b><br/>
 Although all of the default project settings should work fine, the LPCOpen platform code requires a few additional configuration steps.<br/>
</p>
<p>Right click on the project in the Project explorer and select Properties from the popup menu. This will being up the project properties dialog window.<br/>
</p>
<p>From the category list on the left side of the dialog window, select the C/C++ Build option. In the right half of the window, notice that the project contains 2 configurations - Debug and Release. The additional steps indicated below must be applied to both configurations separately. To switch configurations, just select the configuration in the Configuration drop down box.<br/>
 </p>
<div class="image">
<img src="project_settings1.jpg" alt="project_settings1.jpg"/>
</div>
<p>Select the C/C++ Build-&gt;Settings option in the category window and the MCU C Compiler-&gt;Symbols option in the Tool Settings tab in the right window. For the device you are using, you will need to add a new symbol here of value CORE_M0, CORE_M0PLUS, CORE_M3, or CORE_M4. To add this new symbol, click the green + button and type in the name of the symbol and press OK. A list of CORE_M? values to use for each device can be found at one of the links below based on your selected device family.<br/>
 <a class="el" href="group___c_h_i_p__8_x_x___d_r_i_v_e_r___o_p_t_i_o_n_s.html">CHIP: LPC8xx Chip driver build time options</a><br/>
 <a class="el" href="group___c_h_i_p__11_x_x___d_r_i_v_e_r___o_p_t_i_o_n_s.html">CHIP: LPC11xx Chip driver build time options</a><br/>
 <a class="el" href="group___c_h_i_p__13_x_x___d_r_i_v_e_r___o_p_t_i_o_n_s.html">CHIP: LPC13xx Chip driver build time options</a><br/>
 <a class="el" href="group___c_h_i_p__17_x_x__40_x_x___d_r_i_v_e_r___o_p_t_i_o_n_s.html">CHIP: LPC17xx/40xx Chip driver build time options</a><br/>
 <a class="el" href="group___c_h_i_p__18_x_x__43_x_x___d_r_i_v_e_r___o_p_t_i_o_n_s.html">CHIP: LPC18xx/43xx Chip driver build time options</a><br/>
 The example screen below uses CORE_M3 for the LCP1788 device. Do this for both Debug and Release configurations.<br/>
 </p>
<div class="image">
<img src="project_settings2.jpg" alt="project_settings2.jpg"/>
</div>
<p><b>sys_config.h symbols</b><br/>
 If a symbol needed for building a platform isn't included in sys_config.h (see <a class="el" href="_s_y_s_c_o_n_f_i_g__d_e_f__a_d_d.html">Adding platform definitions using sys_config.h</a>), then is must also be added in the symbol list similar to the CORE_M value.<br/>
</p>
<p><b>Xpresso run-time library selection</b><br/>
 Most LPCOpen projects run with the Redlib(none) or Redlib(nohost) libraries. These are the recommended libraries to use when building LPCOpen. For best size, use the (none) version of the library. If you plan on using standard I/O (printf), use the (nohost) version of the library. <em>If you use the DEBUG_ENABLE option (see <a class="el" href="_s_y_s_c_o_n_f_i_g__d_e_f__a_d_d.html">Adding platform definitions using sys_config.h</a>), then use the (nohost) option.</em> The library type can be selected on the quickstart panel.<br/>
 </p>
<div class="image">
<img src="proj_sel_libtype.jpg" alt="proj_sel_libtype.jpg"/>
</div>
<p><b>Adding libraries</b><br/>
 If you want to link with a library, you need to add the library to your project. To add the library, right click on the project in the project explorer window and select properties. Select the C/C++ Build-&gt;Settings option in the category window and the MCU Linker-&gt;Libraries option in the Tool Settings tab in the right window. Locate the library (in this example, it will be in the "&lt;WORKSPACE&gt;\board_lib_1788\debug" or "&lt;WORKSPACE&gt;\board_lib_1788\release" directory) with a name of "libboard_lib_1788.a".<br/>
</p>
<p>In the dialog box, click the green + button in the 'Libraries (-l)' section and add the library to the project. Also click on the green + button in the 'Library search path (-L)' section and add the path to the library in yuor workspace. You will need to do this for debug and release configurations. It is recommended to use the debug library path for the debug configuration and the release library path for the release configuration. Save the settings by pressing the OK button.<br/>
 <em>When adding the library name, remvoe the leading 'lib' and the trailing '.a' from the library filename.</em><br/>
 </p>
<div class="image">
<img src="xpresso_lib_setup1.jpg" alt="xpresso_lib_setup1.jpg"/>
</div>
<p>Ideally, when the executable project is built, other projects that the executable project depends on - such as the board library project - should also automatically re-build if something in them has changed. To add this support, a project depdendency needs to be added to the project. Add the dependency by right click on the project in the project explorer window and select properties. Select the Project references option in the category window and check the 'board_lib_1788' project in the right window. Press OK to save. Now, whenever the executable project is built, the library that the executable project depends on will be built first if it needs to be re-built.<br/>
 </p>
<div class="image">
<img src="xpresso_lib_setup2.jpg" alt="xpresso_lib_setup2.jpg"/>
</div>
<p><b>Adding source files</b><br/>
 To build an executable image, the compiler needs startup code and example code. Start by adding the example source file. In the project explorer window, right click on the project and select New-&gt;File.<br/>
 </p>
<div class="image">
<img src="proj_add_new_file.jpg" alt="proj_add_new_file.jpg"/>
</div>
<p>Type in the file name (main.c) and press Finish.<br/>
 </p>
<div class="image">
<img src="proj_add_new_file_2.jpg" alt="proj_add_new_file_2.jpg"/>
</div>
<p>The file will be added to your project and the empty file will open in the editor view. Add the following code to the file and save it.<br/>
 </p>
<pre class="fragment">#include "board.h"

static void small_delay(int delay)
{
    delay = delay * 100;
 while (delay &gt; 0) {
        delay--;
    }
}

int main(void)
{
 /* Initialize the board layer */
    Board_Init();

    /* Loop forever */
 while (1) {
  Board_LED_Set(0, 1); /* Turn board LED 0 on */
  DEBUGSTR("LED on\r\n");
  small_delay(5000);
  Board_LED_Set(0, 0); /* Turn board LED 0 off */
  DEBUGSTR("LED 0ff\r\n");
  small_delay(5000);
    }

 return 0;
}
</pre><p>Next, add the startup code for the LPC17xx/40xx device family from the LPC17xx/40xx example area. Pre-made startup code can be found in the following directory:<br/>
 "&lt;LPCOPEN_PATH&gt;\applications\lpc17xx_40xx\startup_code".<br/>
 For the Xpresso platform and the Embedded Artistst LPC1788 board, the <a class="el" href="cr__startup__lpc17xx40xx_8c.html">cr_startup_lpc17xx40xx.c</a> file needs to be added to the project. The file can be added to the project by dragging the file from an folder window directly to the project or using the file import option. Select 'Copy files' to move the file into your workspace.<br/>
</p>
<p><b>Adding include paths</b><br/>
 To add include paths to the project, right click on the project in the project explorer window and select properties. Select the C/C++ Build-&gt;Settings option in the category window and the MCU C Compiler-&gt;Includes option in the Tool Settings tab in the right window. Add include paths one at a time to the project by pressing the green + symbol. Be sure to do this for both Debug and Release configurations. Once all the include paths have been added, press OK to return to the workspace view.<br/>
 For the EA1788 board project, the following include paths are needed:<br/>
</p>
<ul>
<li>"&lt;LPCOPEN_PATH&gt;\software\CMSIS\CMSIS\Include"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_ip"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_chip\chip_common"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_chip\chip_lpc17xx_40xx"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_boards\board_common"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_boards\boards_17xx_40xx\ea_devkit_17884088"<br/>
</li>
<li>"&lt;LPCOPEN_PATH&gt;\software\lpc_core\lpc_boards\boards_17xx_40xx\ea_devkit_17884088\ea_devkit_1788" (for EA1788 sys_config.h only)<br/>
 Include paths needed for the Chip and Board layers for a device family can be found at <a class="el" href="_l_p_c_o_p_e_n__p_r_o_j_e_c_t__l_i_b_l_i_s_t.html">LPCOpen library configurations</a>.<br/>
 <div class="image">
<img src="project_include1.jpg" alt="project_include1.jpg"/>
</div>
</li>
</ul>
<p>At this point, the library project is complete. You can build test the debug and release configurations of your project now.<br/>
 </p>
<pre class="fragment">17:02:12 **** Build of configuration Debug for project ea1788_blinky ****
make all 
Building file: ../cr_startup_lpc17xx40xx.c
Invoking: MCU C Compiler
arm-none-eabi-gcc -D__REDLIB__ -DCORE_M3 -DDEBUG -D__CODE_RED -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_ip" -I"C:\dev\git2\lpcopen\software\CMSIS\CMSIS\Include" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_chip\chip_common" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_chip\chip_17xx_40xx" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\board_common" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\boards_17xx_40xx\ea_devkit_17884088" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\boards_17xx_40xx\ea_devkit_17884088\ea_devkit_1788" -O0 -g3 -Wall -c -fmessage-length=0 -fno-builtin -ffunction-sections -fdata-sections -mcpu=cortex-m3 -mthumb -MMD -MP -MF"cr_startup_lpc17xx40xx.d" -MT"cr_startup_lpc17xx40xx.d" -o "cr_startup_lpc17xx40xx.o" "../cr_startup_lpc17xx40xx.c"
Finished building: ../cr_startup_lpc17xx40xx.c
 
Building file: ../main.c
Invoking: MCU C Compiler
arm-none-eabi-gcc -D__REDLIB__ -DCORE_M3 -DDEBUG -D__CODE_RED -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_ip" -I"C:\dev\git2\lpcopen\software\CMSIS\CMSIS\Include" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_chip\chip_common" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_chip\chip_17xx_40xx" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\board_common" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\boards_17xx_40xx\ea_devkit_17884088" -I"C:\dev\git2\lpcopen\software\lpc_core\lpc_board\boards_17xx_40xx\ea_devkit_17884088\ea_devkit_1788" -O0 -g3 -Wall -c -fmessage-length=0 -fno-builtin -ffunction-sections -fdata-sections -mcpu=cortex-m3 -mthumb -MMD -MP -MF"main.d" -MT"main.d" -o "main.o" "../main.c"
Finished building: ../main.c
 
Building target: ea1788_blinky.axf
Invoking: MCU Linker
arm-none-eabi-gcc -nostdlib -L"C:\nxp\workspace\board_lib_1788\Debug" -Xlinker -Map="ea1788_blinky.map" -Xlinker --gc-sections -mcpu=cortex-m3 -mthumb -T "ea1788_blinky_Debug.ld" -o "ea1788_blinky.axf"  ./cr_startup_lpc17xx40xx.o ./main.o   -lboard_lib_1788
Finished building target: ea1788_blinky.axf
 
make --no-print-directory post-build
Performing post-build steps
arm-none-eabi-size "ea1788_blinky.axf"; # arm-none-eabi-objcopy -O binary "ea1788_blinky.axf" "ea1788_blinky.bin" ; checksum -p LPC1343 -d "ea1788_blinky.bin";
   text    data     bss     dec     hex filename
   7312       0       4    7316    1c94 ea1788_blinky.axf
 

17:02:15 Build Finished (took 3s.104ms)
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">LPCOpen Platform for NXP LPC Microcontrollers</a></li><li class="navelem"><a class="el" href="_l_p_c_o_p_e_n__t_e_c_h_l_i_b.html">LPCOpen technical library</a></li><li class="navelem"><a class="el" href="_l_p_c_o_p_e_n__x_p_r_e_s_s_o__p_r_o_j_e_c_t__p_o_r_t_i_n_g__g_u_i_d_e.html">Xpresso: Creating new LPC Xpresso projects</a></li>
    <li class="footer">Generated on Fri May 10 2013 10:42:53 for LPCOpen Platform by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
