<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LPCOpen Platform: C:/nxp/v1.03/lpcopen_v1.03/lpcopen/software/LPCUSBLib/Drivers/USB/Core/HCD/EHCI/EHCI.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="driver.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">LPCOpen Platform
   &#160;<span id="projectnumber">v1.03</span>
   </div>
   <div id="projectbrief">LPCOpen Platform for NXP LPC Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_e_h_c_i_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EHCI.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_e_h_c_i_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * @brief Enhanced Host Controller Interface</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * @note</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright(C) NXP Semiconductors, 2012</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * All rights reserved.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * @par</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * Software that is described herein is for illustrative purposes only</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * which provides customers with programming information regarding the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * LPC products.  This software is supplied &quot;AS IS&quot; without any warranties of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * any kind, and NXP Semiconductors and its licensor disclaim any and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * all warranties, express or implied, including all implied warranties of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * merchantability, fitness for a particular purpose and non-infringement of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * intellectual property rights.  NXP Semiconductors assumes no responsibility</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * or liability for the use of the software, conveys no license or rights under any</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * patent, copyright, mask work right, or any other intellectual property rights in</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * or to any products. NXP Semiconductors reserves the right to make changes</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * in the software without notification. NXP Semiconductors also makes no</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * representation or warranty that such application will be suitable for the</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * specified use without further testing or modification.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * @par</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * Permission to use, copy, modify, and distribute this software and its</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * documentation is hereby granted, under NXP Semiconductors&#39; and its</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * licensor&#39;s relevant copyrights in the software, without fee, provided that it</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * is used in conjunction with NXP Semiconductors microcontrollers.  This</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * copyright, permission, and disclaimer notice must appear in all copies of</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * this code.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/*=======================================================================*/</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/*        I N C L U D E S                                                */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/*=======================================================================*/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#define  __INCLUDE_FROM_USB_DRIVER</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;../../USBMode.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#if (defined(USB_CAN_BE_HOST) &amp;&amp; defined(__LPC_EHCI__))</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#define __LPC_EHCI_C__</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;../../../../../Common/Common.h&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;../../USBTask.h&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;../HCD.h&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_e_h_c_i_8h.html">EHCI.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">// === TODO: Unify USBRAM Section ===</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="group___group___func_var_attributes.html#ga766c23187ccbb4a92ad9d2cd43dacf4d">PRAGMA_ALIGN_32</a></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html">EHCI_HOST_DATA_T</a> <a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[MAX_USB_CORE] __BSS(<a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#abd04b4f369a108ba0bda8dc0d0b8cf68">USBRAM_SECTION</a>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// EHCI_HOST_DATA_T ehci_data __BSS(USBRAM_SECTION);</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<a class="code" href="group___group___func_var_attributes.html#ga8e3674d7cf3d29d00edc5215a69d1f4c">PRAGMA_ALIGN_4096</a></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> <a class="code" href="group___host___e_h_c_i.html#ga87f67dd0b808ef55a3c2161a070b127d">PeriodFrameList0</a>[<a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>] <a class="code" href="group___group___func_var_attributes.html#ga2438155e62fe9b0185e856ade620cd5d">ATTR_ALIGNED</a>(4096) __BSS(<a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#abd04b4f369a108ba0bda8dc0d0b8cf68">USBRAM_SECTION</a>);  <span class="comment">/* Period Frame List */</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="group___group___func_var_attributes.html#ga8e3674d7cf3d29d00edc5215a69d1f4c">PRAGMA_ALIGN_4096</a></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> <a class="code" href="group___host___e_h_c_i.html#ga3b0894dd05dfa9e131fe0e84f4052db3">PeriodFrameList1</a>[<a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>] <a class="code" href="group___group___func_var_attributes.html#ga2438155e62fe9b0185e856ade620cd5d">ATTR_ALIGNED</a>(4096) __BSS(USBRAM_SECTION);  <span class="comment">/* Period Frame List */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<a class="code" href="struct_pipe___stream___handle___t.html">Pipe_Stream_Handle_T</a> PipeStreaming[MAX_USB_CORE];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/*=======================================================================*/</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">/* G L O B A L   F U N C T I O N S                                       */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/*=======================================================================*/</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga84f1b4861ea0e5434bec10fac23145f3" title="Initiate host driver.">HcdInitDriver</a>(uint8_t HostID)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga8b57fc562a04d94e94efab41d3226712">EHciHostReset</a>(HostID);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___host___e_h_c_i.html#gaad8f6214fbf8ce990f92b2fcf9921025">EHciHostInit</a>(HostID);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga89a43199da4242d64251222c54331077" title="De-initiate host driver.">HcdDeInitDriver</a>(uint8_t HostID)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H = 0xFFFFFFFF;    <span class="comment">/* clear all current interrupts */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H &amp;= ~(1 &lt;&lt; 12);   <span class="comment">/* clear port power */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBMODE_H =   (1 &lt;&lt; 0);    <span class="comment">/* set USB mode reserve */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga11f69764dc00e671a40a783ff2b56153" title="Turn on 5V USB VBUS.">HcdRhPortEnable</a>(uint8_t HostID)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga14341134f35be36fbb5c99b549d47f2e" title="Turn off 5V USB VBUS.">HcdRhPortDisable</a>(uint8_t HostID)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;{</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga8d635796a070fb9d6b3fa68b2075d052" title="Perform USB bus reset.">HcdRhPortReset</a>(uint8_t HostID)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; <a class="code" href="_h_c_d_8c.html#af80a0c5b1fc240b0d7777b2255d55d60">HcdDelayMS</a>(<a class="code" href="group___group___h_c_d.html#gaf5156aa28161e9db1923cd16eb5e8e95">PORT_RESET_PERIOD_MS</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H &amp;= ~<a class="code" href="group___host___e_h_c_i.html#ga36f4af7d6aeb448883188e24fb64c272">EHC_PORTSC_PortEnable</a>; <span class="comment">/* Disable Port first */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#gaeb87194429114f564a89a3ac96828055">EHC_PORTSC_PortReset</a>; <span class="comment">/* Reset port */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; <span class="comment">/* should have time-out */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; <span class="keywordflow">while</span> (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H &amp; <a class="code" href="group___host___e_h_c_i.html#gaeb87194429114f564a89a3ac96828055">EHC_PORTSC_PortReset</a>) {}</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; <span class="comment">/* PortEnable is always set - Deviation from EHCI */</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; <a class="code" href="_h_c_d_8c.html#af80a0c5b1fc240b0d7777b2255d55d60">HcdDelayMS</a>(<a class="code" href="group___group___h_c_d.html#gaf5156aa28161e9db1923cd16eb5e8e95">PORT_RESET_PERIOD_MS</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga8398cadb70c76907141670c95456c7e4" title="Clear stall status for connected endpoint.">HcdClearEndpointHalt</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle)<span class="comment">// FIXME not implemented</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>   <a class="code" href="group___group___h_c_d.html#gae6100a48ff82de9087b315484409d5ec" title="Get current frame number.">HcdGetFrameNumber</a>(uint8_t HostID)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;FRINDEX_H;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga704518f1889453e7f909427761b82ff4" title="Get operation speed of connected device.">HcdGetDeviceSpeed</a>(uint8_t HostID, <a class="code" href="group___group___h_c_d.html#gaeecec3cc01ee5c46f9344fef56e9baba">HCD_USB_SPEED</a> *DeviceSpeed)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; <span class="keywordflow">if</span> ( <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H &amp; <a class="code" href="group___host___e_h_c_i.html#ga27f7ff4cb993f50d00c0b2ccdad55f5f">EHC_PORTSC_CurrentConnectStatus</a>) {<span class="comment">/* If device is connected */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  *DeviceSpeed = (<a class="code" href="group___group___h_c_d.html#gaeecec3cc01ee5c46f9344fef56e9baba">HCD_USB_SPEED</a>) ( (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H &amp; <a class="code" href="group___host___e_h_c_i.html#gafe3974b78a2661d7619ac9b2d1be07a4">EHC_PORTSC_PortSpeed</a>) &gt;&gt; 26 ); <span class="comment">/* TODO magic number */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770af48b227654aed9a4fcfaa6c240410b11">HCD_STATUS_DEVICE_DISCONNECTED</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;}</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#gabb5bfa441f10221d799d0d036d4cd068" title="Setup a pipe to connect to device&#39;s logical endpoint.">HcdOpenPipe</a>(uint8_t HostID,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        uint8_t DeviceAddr,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="group___group___h_c_d.html#gaeecec3cc01ee5c46f9344fef56e9baba">HCD_USB_SPEED</a> DeviceSpeed,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        uint8_t <a class="code" href="_e_h_c_i_8h.html#aa2027e9db1affb0a452a005193f4152c">EndpointNumber</a>,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> TransferType,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="group___group___h_c_d.html#ga73cca83d94e0ec89616c7e834542f2d7">HCD_TRANSFER_DIR</a> TransferDir,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        uint16_t MaxPacketSize,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        uint8_t <a class="code" href="_e_h_c_i_8h.html#abffdf7397ffed53fb424508ed16bac54">Interval</a>,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        uint8_t <a class="code" href="_e_h_c_i_8h.html#a1023511d3bf9044a771f695c40943921">Mult</a>,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        uint8_t HSHubDevAddr,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        uint8_t HSHubPortNum,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *<span class="keyword">const</span> pPipeHandle)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> HeadIdx;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#if !ISO_LIST_ENABLE</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">if</span> ( TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a> ) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7f8e297a1dfcd82d0193f0b39acc5b96">HCD_STATUS_TRANSFER_TYPE_NOT_SUPPORTED</a>, <span class="stringliteral">&quot;Please set ISO_LIST_ENABLE to YES&quot;</span>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#if !INTERRUPT_LIST_ENABLE</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">if</span> ( TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a> ) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7f8e297a1dfcd82d0193f0b39acc5b96">HCD_STATUS_TRANSFER_TYPE_NOT_SUPPORTED</a>, <span class="stringliteral">&quot;Please set INTERRUPT_LIST_ENABLE to YES&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; <span class="comment">/********************************* Parameters Verify *********************************/</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="_h_c_d_8c.html#a6665168f4ade486019d6c9ce1a770979">OpenPipe_VerifyParameters</a>(HostID, DeviceAddr, DeviceSpeed, EndpointNumber, TransferType,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;              TransferDir, MaxPacketSize, Interval, Mult) );</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; EndpointNumber &amp;= 0xF; <span class="comment">/* Endpoint number is in range 0-15 */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; MaxPacketSize &amp;= 0x3FF; <span class="comment">/* Max Packet Size is in range 0-1024 */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; <span class="keywordflow">switch</span> (TransferType) { <span class="comment">// TODO should unify more, perharps later</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6ae31b30c507e9962fa0b5edef2a5388a3">CONTROL_TRANSFER</a>:</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a5db356d79cb4a32a6e6aa9b38b58d93e">BULK_TRANSFER</a>:</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga128bab734759a4e14e28c9f0f6185dbd">AllocQhd</a>(HostID, DeviceAddr, DeviceSpeed, EndpointNumber, TransferType, TransferDir,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          MaxPacketSize, Interval, Mult, HSHubDevAddr, HSHubPortNum, &amp;HeadIdx) );</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga58cefec516a4db85547a2c3341327de8">DisableAsyncSchedule</a>(HostID);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga36a6feb6453eeca2db858455e5735edb">InsertLinkPointer</a>(&amp;<a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, &amp;<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gab89d08ef6aae4306eff1dc00a14cc629">EnableAsyncSchedule</a>(HostID);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>:</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga128bab734759a4e14e28c9f0f6185dbd">AllocQhd</a>(HostID, DeviceAddr, DeviceSpeed, EndpointNumber, TransferType, TransferDir,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;          MaxPacketSize, Interval, Mult, HSHubDevAddr, HSHubPortNum, &amp;HeadIdx) );</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga9fd1a765b6d100bfb1ef5040956763c6">DisablePeriodSchedule</a>(HostID);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga36a6feb6453eeca2db858455e5735edb">InsertLinkPointer</a>(&amp;<a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, &amp;<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gad1d134c340b7746210ca40d4bb5d14cc">EnablePeriodSchedule</a>(HostID);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  memset(&amp;PipeStreaming[HostID], 0, <span class="keyword">sizeof</span>(<a class="code" href="struct_pipe___stream___handle___t.html">Pipe_Stream_Handle_T</a>));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>:</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#ifndef __TEST__</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (( DeviceSpeed == <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a>) || ( TransferDir == <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a>) ) { <span class="comment">/* TODO currently not support HS due to lack of device for testing */</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7f8e297a1dfcd82d0193f0b39acc5b96">HCD_STATUS_TRANSFER_TYPE_NOT_SUPPORTED</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="stringliteral">&quot;Highspeed ISO and ISO IN is not supported yet, due to lack of testing&quot;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor"></span>  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga128bab734759a4e14e28c9f0f6185dbd">AllocQhd</a>(HostID, DeviceAddr, DeviceSpeed, EndpointNumber, TransferType, TransferDir,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          MaxPacketSize, Interval, Mult, HSHubDevAddr, HSHubPortNum, &amp;HeadIdx) );</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gad1d134c340b7746210ca40d4bb5d14cc">EnablePeriodSchedule</a>(HostID);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaf36bcbb02e524cd8236a726fb412727a">PipehandleCreate</a>(pPipeHandle, HostID, TransferType, HeadIdx);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga8b5dd374cb6bd4428b94c80a0a5ebd1f" title="Delete the link between USB host and device&#39;s logical endpoint.">HcdClosePipe</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; uint8_t HostID, HeadIdx;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___group___h_c_d.html#ga0e4ade8e46127b3e1e7edee7daf569c8" title="Cancel a processing transfer.">HcdCancelTransfer</a>(PipeHandle) );</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;HeadIdx) );</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; <span class="keywordflow">switch</span> (XferType) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6ae31b30c507e9962fa0b5edef2a5388a3">CONTROL_TRANSFER</a>:</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a5db356d79cb4a32a6e6aa9b38b58d93e">BULK_TRANSFER</a>:</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gae30ed658e9c78617fcf81e7ed8b5990c">RemoveQueueHead</a>(HostID, HeadIdx);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H |= <a class="code" href="group___host___e_h_c_i.html#gae01f087130080f616e2ec9a786d5c0e6">EHC_USBCMD_IntAsyncAdvanceDoorbell</a>; <span class="comment">/* DoorBell Handshake: Queue Head will only be free in AsyncAdvanceIsr */</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; <span class="keywordflow">case</span> <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5c3e4a6982d0caf87344e9b8ca680236">FreeQhd</a>(HostID, HeadIdx);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga9fd1a765b6d100bfb1ef5040956763c6">DisablePeriodSchedule</a>(HostID);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga0e4ade8e46127b3e1e7edee7daf569c8" title="Cancel a processing transfer.">HcdCancelTransfer</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;{</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; uint8_t HostID, HeadIdx;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;HeadIdx) );</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga4285cb83300fac9a0ab772a19f0320d0">DisableSchedule</a>(HostID, (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>) || (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>) ? 1 : 0);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; <span class="keywordflow">if</span> (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>) { <span class="comment">/* ISOCHRONOUS_TRANSFER */</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> i;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>; i++) { <span class="comment">/*-- Foreach link in Period List Base --*/</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   <a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *pNextPointer = &amp;<a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[i];</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   <span class="comment">/*-- Foreach Itd/SItd in the link--*/</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>) &amp;&amp; pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> != <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a>) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> == <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a65958b2b656799921b822cb91560bd78">ITD_TYPE</a>) { <span class="comment">/*-- Highspeed ISO --*/</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;     <a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a> pItd = (<a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a>) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;     <span class="keywordflow">if</span> (HeadIdx == pItd-&gt;IhdIdx) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">/*-- remove matched ITD --*/</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = pItd-&gt;Horizontal.Link;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="group___host___e_h_c_i.html#ga151710f74fbfe7b1283b4350039829ac">FreeHsItd</a>(pItd);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">/*-- skip advance pNextPointer due to TD removal --*/</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;     }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> == <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487ad758c6972d6d7e1067715f01df0f0f2c">SITD_TYPE</a>) { <span class="comment">/*-- Split ISO --*/</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;     <a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a> pSItd = (<a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a>) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;     <span class="keywordflow">if</span> (HeadIdx == pSItd-&gt;IhdIdx) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">/*-- removed matched SITD --*/</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = pSItd-&gt;Horizontal.Link;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="group___host___e_h_c_i.html#gaa43742bc0c51f164bd795183d4054ec9">FreeSItd</a>(pSItd);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">/*-- skip advance pNextPointer due to TD removal --*/</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;     }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    pNextPointer = (<a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; <span class="keywordflow">else</span> { <span class="comment">/*-- Bulk / Control / Interrupt --*/</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdLink = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;FirstQtd;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">/*-- Foreach Qtd in Qhd --*/</span> <span class="comment">/*---------- Deactivate all queued TDs ----------*/</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(TdLink) ) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   PHCD_QTD pQtd = (PHCD_QTD) Align32(TdLink);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   TdLink = pQtd-&gt;NextQtd;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   pQtd-&gt;Active = 0;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   pQtd-&gt;IntOnComplete = 0;<span class="comment">/* no interrupt scenario on this TD */</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga4bad6030f9a671d0ddb3b2d487563d94">FreeQtd</a>(pQtd);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;FirstQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaff7c53d303b2d85cb5c31a641338bf89">EnableSchedule</a>(HostID, (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>) || (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>) ? 1 : 0);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#ga4daca978fda59e848ce32ffe0d775859" title="Perform a control transfer.">HcdControlTransfer</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;         <span class="keyword">const</span> <a class="code" href="group___group___std_request.html#ga0617eff86418442fd03ee45d3220592f">USB_Request_Header_t</a> *<span class="keyword">const</span> pDeviceRequest,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;         uint8_t *<span class="keyword">const</span> <a class="code" href="group___e_x_a_m_p_l_e_s___p_e_r_i_p_h__18_x_x43_x_x___e_e_p_r_o_m.html#ga3d2f5982b0a951fa1b6800855ac2b501">buffer</a>)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;{</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; uint8_t HostID, QhdIdx;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> SetupTdIdx, DataTdIdx, StatusTdIdx;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; uint8_t direction;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> Datalength;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; <span class="keywordflow">if</span> ((pDeviceRequest == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (buffer == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a98e352c2532d7132781db8d00152a128">HCD_STATUS_PARAMETER_INVALID</a>, <span class="stringliteral">&quot;Device Request or Data Buffer is NULL&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;QhdIdx) );</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; Datalength = pDeviceRequest-&gt;wLength;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; direction =  pDeviceRequest-&gt;bmRequestType &amp; 0x80;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; <span class="comment">/*---------- Setup Stage ----------*/</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, &amp;SetupTdIdx, (uint8_t *) pDeviceRequest, 8, <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7acaeea41a1c64f0ecc7604e7fde76d98a">SETUP_TRANSFER</a>, 0, 0) );   <span class="comment">/* Setup TD: DirectionPID=00 - DataToggle=10b (always DATA0) */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; <span class="comment">/*---------- Data Stage ----------*/</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; <span class="keywordflow">if</span> (Datalength) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, &amp;DataTdIdx, buffer, Datalength, direction ? <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a> : <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a>, 1, 0) );</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  DataTdIdx = SetupTdIdx; <span class="comment">/* Data TD is skipped */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; <span class="comment">/*---------- Status Stage ----------*/</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, &amp;StatusTdIdx, <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, direction ? <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a> : <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a>, 1, 1) ); <span class="comment">/* Status TD: Direction=opposite of data direction - DataToggle=11b (always DATA1) */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; <span class="comment">/* Hook TDs Together */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, SetupTdIdx)-&gt;NextQtd = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, DataTdIdx);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, DataTdIdx)-&gt;NextQtd = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, StatusTdIdx);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;status = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770acb7f44e80fbfbdab4b623f5433195e8f">HCD_STATUS_TRANSFER_QUEUED</a>;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; <span class="comment">/* Hook TDs to QHD */</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;FirstQtd = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, SetupTdIdx) );</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;Overlay.NextQtd = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, SetupTdIdx);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; <span class="comment">/* wait for semaphore compete TDs */</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga2533035484510105e07db0ff204963fa">WaitForTransferComplete</a>(HostID, QhdIdx) );</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#gab92150585f7cb271173ddb605ae8d2b3" title="Perform a non-control transfer.">HcdDataTransfer</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;         uint8_t *<span class="keyword">const</span> buffer,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;         <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> <span class="keyword">const</span> length,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         uint16_t *<span class="keyword">const</span> pActualTransferred)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; uint8_t HostID, HeadIdx;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> DataTdIdx;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> ExpectedLength;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; <span class="keywordflow">if</span> ((buffer == <a class="code" href="group___l_p_c___types___public___macros.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (length == 0)) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a98e352c2532d7132781db8d00152a128">HCD_STATUS_PARAMETER_INVALID</a>, <span class="stringliteral">&quot;Data Buffer is NULL or Transfer Length is 0&quot;</span>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;HeadIdx) );</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; ExpectedLength = (length != <a class="code" href="group___group___h_c_d.html#ga548d4aee98871e5244d8cab26ffaa940">HCD_ENDPOINT_MAXPACKET_XFER_LEN</a>) ? length : <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;MaxPackageSize;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;status = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770acb7f44e80fbfbdab4b623f5433195e8f">HCD_STATUS_TRANSFER_QUEUED</a>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; <span class="keywordflow">if</span> (XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a3a7b9d2a23b2e132cb88e5aef6587893">ISOCHRONOUS_TRANSFER</a>) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;EndpointSpeed == <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> ) { <span class="comment">/*-- Highspeed ISO --*/</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga94f2514358fe5c8973adff6ee6d46dcf">QueueITDs</a>(HostID, HeadIdx, buffer, ExpectedLength) );</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">/*-- Full/Low Speed ISO --*/</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga73c8a4e236d4f592b5053fc26bbb3c8a">QueueSITDs</a>(HostID, HeadIdx, buffer, ExpectedLength) );</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; <span class="keywordflow">else</span> { <span class="comment">/*-- Control / Bulk / Interrupt --*/</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">if</span>(XferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a5db356d79cb4a32a6e6aa9b38b58d93e">BULK_TRANSFER</a>)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>( <a class="code" href="group___host___e_h_c_i.html#gaf95582ce3d53baf979d776958a2ff0a2">QueueQTDs</a>(HostID, &amp;DataTdIdx, buffer, ExpectedLength,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#ab94410c1333b512e271b1c135fe50916">Direction</a> ? <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a> : <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a>, 0) );</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, &amp;DataTdIdx, buffer, ExpectedLength,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#ab94410c1333b512e271b1c135fe50916">Direction</a> ? <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a> : <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a>, 0, 1) );</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">/*---------- Hook to Queue Head ----------*/</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;FirstQtd = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, DataTdIdx) ); <span class="comment">/* used as TD head to clean up TD chain when transfer done */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;Overlay.NextQtd = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, DataTdIdx);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;pActualTransferCount = pActualTransferred; <span class="comment">/* TODO Actual Length get rid of this */</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#af612b8725078c33615468fdb74de4f2e">pActualTransferCount</a>) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  *(<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;pActualTransferCount) = ExpectedLength;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___group___h_c_d.html#gaf63171a17881496f63c0029c34de5a95" title="Get current pipe status.">HcdGetPipeStatus</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle)<span class="comment">/* TODO can be implemented based on overlay */</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; uint8_t HostID, HeadIdx;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;HeadIdx) );</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; <span class="keywordflow">return</span> (<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a>)<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;status;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga5c3e4a6982d0caf87344e9b8ca680236">FreeQhd</a>(uint8_t HostID, uint8_t QhdIdx)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;{</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770acc61d671d2b311b2ac14670945764a85">HCD_STATUS_STRUCTURE_IS_FREE</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;Horizontal.Link |= <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;inUse = 0;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga128bab734759a4e14e28c9f0f6185dbd">AllocQhd</a>(uint8_t HostID,</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;         uint8_t DeviceAddr,</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <a class="code" href="group___group___h_c_d.html#gaeecec3cc01ee5c46f9344fef56e9baba">HCD_USB_SPEED</a> DeviceSpeed,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;         uint8_t EndpointNumber,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;         <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> TransferType,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;         <a class="code" href="group___group___h_c_d.html#ga73cca83d94e0ec89616c7e834542f2d7">HCD_TRANSFER_DIR</a> TransferDir,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;         uint16_t MaxPacketSize,</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;         uint8_t Interval,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;         uint8_t Mult,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;         uint8_t HSHubDevAddr,</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;         uint8_t HSHubPortNum,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;         <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *pQhdIdx)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; <span class="comment">/* Looking for a free QHD */</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; <span class="keywordflow">for</span> ( (*pQhdIdx) = 0; (*pQhdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a> &amp;&amp; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;inUse; (*pQhdIdx)++) {}</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; <span class="keywordflow">if</span> ((*pQhdIdx) == <a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a> ) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770aa39646b6eb615929f97a65517a922d57">HCD_STATUS_NOT_ENOUGH_ENDPOINT</a>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; memset(<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx), 0, <span class="keyword">sizeof</span>(HCD_QHD) );</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; <span class="comment">/* Init Data For Queue Head */</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;inUse = 1;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Direction = (TransferDir == <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a>) ? 1 : 0;  <span class="comment">/* Control Endpoint should not use this parameter */</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Interval = <a class="code" href="_e_h_c_i_8h.html#abffdf7397ffed53fb424508ed16bac54">Interval</a>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;FirstQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Horizontal.Link = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;DeviceAddress = DeviceAddr;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;InActiveOnNextTransaction = 0;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;EndpointNumber = <a class="code" href="_e_h_c_i_8h.html#aa2027e9db1affb0a452a005193f4152c">EndpointNumber</a>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;EndpointSpeed = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) DeviceSpeed;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;DataToggleControl = (TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6ae31b30c507e9962fa0b5edef2a5388a3">CONTROL_TRANSFER</a>) ? 1 : 0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;HeadReclamationFlag = 0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;MaxPackageSize = MaxPacketSize;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;     *pQhdIdx)-&gt;ControlEndpointFlag = (DeviceSpeed != <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> &amp;&amp; TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6ae31b30c507e9962fa0b5edef2a5388a3">CONTROL_TRANSFER</a>) ? 1 : 0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;NakCountReload = 0; <span class="comment">/* infinite NAK/NYET */</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; <span class="comment">/*-- Currently All interrupt endpoints will be served as 1 (micro)frame polling, thus Interval parameter is ignored --*/</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; <span class="comment">/*-- For High Speed Interval should be used to compute the uFrameSMask --*/</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;     *pQhdIdx)-&gt;uFrameSMask =</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  (TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>) ? (DeviceSpeed == <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> ? 0xFF : 0x01) : 0;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;     *pQhdIdx)-&gt;uFrameCMask = (DeviceSpeed != <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> &amp;&amp; TransferType == <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a>) ? 0x1C : 0;   <span class="comment">/*-- Schedule Complete Split at uFrame2, uFrame3 and uFrame4 --*/</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;HubAddress = HSHubDevAddr;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;PortNumber = HSHubPortNum;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Mult = (DeviceSpeed == <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> ? Mult : 1);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Overlay.NextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;Overlay.AlterNextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, *pQhdIdx)-&gt;FirstQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;     *pQhdIdx)-&gt;Overlay.PingState_Err =</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  (DeviceSpeed == <a class="code" href="group___group___h_c_d.html#ggaeecec3cc01ee5c46f9344fef56e9babaa8208c88a94cc5e919193f2ceeb370c6d">HIGH_SPEED</a> &amp;&amp; TransferType != <a class="code" href="group___group___h_c_d.html#gga591c7d63482e6bd11c5a8bbb3629aff6a6788bdc073b5513dfe5315dd2801d5f7">INTERRUPT_TRANSFER</a> &amp;&amp; TransferDir == <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a>) ? 1 : 0;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga36a6feb6453eeca2db858455e5735edb">InsertLinkPointer</a>(<a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *pList, <a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *pNew, uint8_t type)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;{</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; pNew-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = pList-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; pList-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) pNew);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; pList-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> = type;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gae30ed658e9c78617fcf81e7ed8b5990c">RemoveQueueHead</a>(uint8_t HostID, uint8_t QhdIdx)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;{</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd = <a class="code" href="group___host___e_h_c_i.html#ga9ba6602d794a9a2e7dcc8d5b22f846da">IsInterruptQhd</a>(HostID, QhdIdx) ? <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID) : <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; <span class="comment">/*-- Foreach Qhd in async list --*/</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pQhd-&gt;Horizontal.Link) &amp;&amp;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   Align32(pQhd-&gt;Horizontal.Link) != (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx) &amp;&amp;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   Align32(pQhd-&gt;Horizontal.Link) != (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID) ) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  pQhd = (<a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>) Align32(pQhd-&gt;Horizontal.Link);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; <span class="keywordflow">if</span> (  Align32(pQhd-&gt;Horizontal.Link) != (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx) ) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a98e352c2532d7132781db8d00152a128">HCD_STATUS_PARAMETER_INVALID</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;status = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7d3c643b34e337357530073b20a600a3">HCD_STATUS_TO_BE_REMOVED</a>; <span class="comment">/* Will be remove in AsyncAdvanceIsr - make use of IAAD */</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; pQhd-&gt;Horizontal.Link = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;Horizontal.Link;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">/*---------- Queue TD Routines ----------*/</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga4bad6030f9a671d0ddb3b2d487563d94">FreeQtd</a>(PHCD_QTD pQtd)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;{</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; pQtd-&gt;NextQtd |= <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; pQtd-&gt;inUse = 0;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(uint8_t HostID,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;         <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *pTdIdx,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;         uint8_t *<span class="keyword">const</span> <a class="code" href="_e_h_c_i_8h.html#af2e16a1cebd5cbb02c3a54243032cd9a">BufferPointer</a>,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;         <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> xferLen,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;         <a class="code" href="group___group___h_c_d.html#ga73cca83d94e0ec89616c7e834542f2d7">HCD_TRANSFER_DIR</a> PIDCode,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;         uint8_t <a class="code" href="_o_h_c_i_8h.html#a64146dc9a06f3881c0f377a438e1f566">DataToggle</a>,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;         uint8_t IOC)</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;{</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; <span class="keywordflow">for</span> ((*pTdIdx) = 0; (*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a> &amp;&amp; <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;inUse; (*pTdIdx)++) {}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; <span class="keywordflow">if</span> ((*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a>) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  uint8_t idx = 1;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> BytesInPage;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  memset(<a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx), 0, <span class="keyword">sizeof</span>(<a class="code" href="struct_h_c_d___q_t_d.html">HCD_QTD</a>));</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;NextQtd = 1;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;AlterNextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;inUse = 1;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;Active = 1;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;PIDCode = (PIDCode == <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7acaeea41a1c64f0ecc7604e7fde76d98a">SETUP_TRANSFER</a>) ? 2 : (PIDCode == <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a> ? 1 : 0);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;TotalBytesToTransfer = xferLen;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;DataToggle = <a class="code" href="_o_h_c_i_8h.html#a64146dc9a06f3881c0f377a438e1f566">DataToggle</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;IntOnComplete = IOC;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, *pTdIdx)-&gt;BufferPointer[0] = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) BufferPointer;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  BytesInPage = 0x1000 - Offset4k((<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) BufferPointer);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  xferLen -= <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, BytesInPage); <span class="comment">/*-- Trim down xferlen to be multiple of 4k --*/</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">for</span> (idx = 1; idx &lt;= 4 &amp;&amp; xferLen &gt; 0; idx++) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;       *pTdIdx)-&gt;BufferPointer[idx] = Align4k(<a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID, (*pTdIdx))-&gt;BufferPointer[idx - 1]) + 0x1000;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   xferLen -= <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, 0x1000);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a5a3941ab056dca67a81018f876f36bf4">HCD_STATUS_NOT_ENOUGH_QTD</a>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;}</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gaf95582ce3d53baf979d776958a2ff0a2">QueueQTDs</a> (uint8_t HostID,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>* pTdIdx,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        uint8_t* dataBuff,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> xferLen,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="group___group___h_c_d.html#ga73cca83d94e0ec89616c7e834542f2d7">HCD_TRANSFER_DIR</a> PIDCode,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        uint8_t DataToggle)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TailTdIdx=0xFFFFFFFF;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; <span class="keywordflow">while</span> (xferLen &gt; 0)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdLen;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> MaxTDLen = <a class="code" href="group___host___e_h_c_i.html#gaacd500aa41f4a14c15e3cee0815000c6">QTD_MAX_XFER_LENGTH</a> - Offset4k((<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>)dataBuff);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span>(PipeStreaming[HostID].PacketSize &gt; 0)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   TdLen = <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, PipeStreaming[HostID].PacketSize);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   TdLen = <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, MaxTDLen);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  xferLen -= TdLen;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">if</span> (TailTdIdx == 0xFFFFFFFF)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a> ( <a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, pTdIdx, dataBuff, TdLen, PIDCode, DataToggle, (xferLen==0) ? 1 : 0) );</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   TailTdIdx = *pTdIdx;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> NewTdIDx;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a> == <a class="code" href="group___host___e_h_c_i.html#ga79236cf0fad396effdfd0be4c499d72f">AllocQTD</a>(HostID, &amp;NewTdIDx, dataBuff, TdLen, PIDCode, DataToggle, (xferLen==0) ? 1 : 0))</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,TailTdIdx)-&gt;NextQtd = Align32((<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,NewTdIDx));</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    TailTdIdx = NewTdIDx;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    PipeStreaming[HostID].BufferAddress = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>)dataBuff;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    PipeStreaming[HostID].RemainBytes = xferLen + TdLen;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    PipeStreaming[HostID].DataToggle = <a class="code" href="_o_h_c_i_8h.html#a64146dc9a06f3881c0f377a438e1f566">DataToggle</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,<a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a> - 1)-&gt;IntOnComplete = 1;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span>(DataToggle == 1) DataToggle = 0;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">else</span> DataToggle = 1;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  dataBuff += TdLen;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; <span class="keywordflow">if</span>(xferLen == 0)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  memset(&amp;PipeStreaming[HostID], 0, <span class="keyword">sizeof</span>(<a class="code" href="struct_pipe___stream___handle___t.html">Pipe_Stream_Handle_T</a>));</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;}</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga151710f74fbfe7b1283b4350039829ac">FreeHsItd</a>(<a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a> pItd)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;{</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; pItd-&gt;Horizontal.Link |= <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; pItd-&gt;inUse = 0;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gaec6d34545b1ee4656a03b90aef286e24">AllocHsItd</a>(uint8_t HostID,</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;       <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *pTdIdx,</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;       uint8_t <a class="code" href="_e_h_c_i_8h.html#a83afbf0bda322b836cfcb238c5db327c">IhdIdx</a>,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;       uint8_t *dataBuff,</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;       <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TDLen,</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;       uint8_t XactPerITD,</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;       uint8_t <a class="code" href="_e_h_c_i_8h.html#afd158f5b8d90362bb3254258e3dbabb6">IntOnComplete</a>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;{</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; <span class="keywordflow">for</span> ((*pTdIdx) = 0; (*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#gab28caad7c9dee132f6e7eaf83b2975c9">HCD_MAX_HS_ITD</a> &amp;&amp; <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;inUse; (*pTdIdx)++) {}</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; <span class="keywordflow">if</span> ((*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#gab28caad7c9dee132f6e7eaf83b2975c9">HCD_MAX_HS_ITD</a>) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  uint8_t i;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  uint8_t XactStep = 8 / XactPerITD;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> MaxXactLen = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;MaxPackageSize * <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;Mult;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  memset(<a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx), 0, <span class="keyword">sizeof</span>(HCD_HS_ITD));</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;inUse = 1;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;IhdIdx = <a class="code" href="_e_h_c_i_8h.html#a83afbf0bda322b836cfcb238c5db327c">IhdIdx</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Horizontal.Link = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordflow">for</span> (i = 0; TDLen &gt; 0 &amp;&amp; i &lt; 8; i += XactStep) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> XactLen = <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(TDLen, MaxXactLen);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   TDLen -= XactLen;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[i] = Align4k( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) dataBuff);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Transaction[i].Offset = ( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) dataBuff ) &amp; 4095;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Transaction[i].PageSelect = i;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Transaction[i].IntOnComplete = (IntOnComplete &amp;&amp; TDLen == 0) ? 1 : 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Transaction[i].Length = XactLen;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;Transaction[i].Active = 1;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   dataBuff += XactLen;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[0] |= (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;EndpointNumber &lt;&lt; 8) | <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID,</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                             IhdIdx)-&gt;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                <a class="code" href="_e_h_c_i_8h.html#a9246c9efbc1b7c2cb4b247041f082fe4">DeviceAddress</a>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID,</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;     *pTdIdx)-&gt;BufferPointer[1] |=</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;Direction &lt;&lt; 1) | <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;MaxPackageSize;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[2] |= <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;Mult;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a722b12e322303f0353f902568173fa78">HCD_STATUS_NOT_ENOUGH_HS_ITD</a>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga94f2514358fe5c8973adff6ee6d46dcf">QueueITDs</a>(uint8_t HostID, uint8_t IhdIdx, uint8_t *dataBuff, <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> xferLen)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;{</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> MaxTDLen;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> FrameIdx;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="preprocessor">#if 0 </span><span class="comment">/* Maximum bandwidth (Interval = 1) regardless of Interval value */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="preprocessor"></span> uint8_t XactPerITD;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> FramePeriod;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(IhdIdx)-&gt;Interval &lt; 4) { <span class="comment">/*-- Period &lt; 8 --*/</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  XactPerITD = 1 &lt;&lt; ( 4 - <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(IhdIdx)-&gt;Interval );  <span class="comment">/*-- Interval 1 =&gt; 8, 2 =&gt; 4, 3 =&gt; 2 --*/</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  FramePeriod = 1;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  XactPerITD = 1;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  FramePeriod = 1 &lt;&lt; ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(IhdIdx)-&gt;Interval - 4 ); <span class="comment">/*-- Frame step 4 =&gt; 1, 5 =&gt; 2, 6 =&gt; 3 --*/</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="preprocessor"></span><span class="preprocessor"> #define XactPerITD      8</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor"></span><span class="preprocessor"> #define FramePeriod     1</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; MaxTDLen = XactPerITD * <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;MaxPackageSize * <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, IhdIdx)-&gt;Mult;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; FrameIdx = <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;FRINDEX_H &gt;&gt; 3;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; <span class="keywordflow">if</span> (xferLen &gt; MaxTDLen * FRAME_LIST_SIZE) { <span class="comment">/*-- Data length overflow the Period FRAME LIST  --*/</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770ab9821977ac8da775567ffe66120ee9f7">HCD_STATUS_DATA_OVERFLOW</a>,</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   <span class="stringliteral">&quot;ISO data length overflows the Period Frame List size, Please increase size by FRAMELIST_SIZE_BITS or reduce data length&quot;</span>);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; <span class="keywordflow">while</span> (xferLen &gt; 0) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdIdx;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TDLen;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  TDLen = <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, MaxTDLen);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  xferLen -= TDLen;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#gaec6d34545b1ee4656a03b90aef286e24">AllocHsItd</a>(HostID, &amp;TdIdx, IhdIdx, dataBuff, TDLen, XactPerITD, xferLen ? 0 : 1) );</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  FrameIdx = (FrameIdx + FramePeriod) % FRAME_LIST_SIZE;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">/*-- Hook ITD to Period List Base --*/</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga36a6feb6453eeca2db858455e5735edb">InsertLinkPointer</a>(&amp;<a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[FrameIdx], &amp;<a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(HostID, TdIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a65958b2b656799921b822cb91560bd78">ITD_TYPE</a>);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  dataBuff += TDLen;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;}</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gaa43742bc0c51f164bd795183d4054ec9">FreeSItd</a>(<a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a> pSItd)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;{</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; pSItd-&gt;Horizontal.Link |= <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; pSItd-&gt;inUse = 0;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;}</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga881fa4095fa5b0ea4c96f5b5069d6be9">AllocSItd</a>(uint8_t HostID,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;       <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *pTdIdx,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;       uint8_t HeadIdx,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;       uint8_t *dataBuff,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;       <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TDLen,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;       uint8_t IntOnComplete)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor">#define TCount_Pos 0</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TPos_Pos 3</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; <span class="keywordflow">for</span> ((*pTdIdx) = 0; (*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#ga39408591d06060ba83ded8ca467a606f">HCD_MAX_SITD</a> &amp;&amp; <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;inUse; (*pTdIdx)++) {}</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; <span class="keywordflow">if</span> ((*pTdIdx) &lt; <a class="code" href="group___host___e_h_c_i.html#ga39408591d06060ba83ded8ca467a606f">HCD_MAX_SITD</a>) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  uint8_t TCount = TDLen / <a class="code" href="group___host___e_h_c_i.html#gaa3e119957c2944c284ff5f0a415d1d5a">SPLIT_MAX_LEN_UFRAME</a> + (TDLen % <a class="code" href="group___host___e_h_c_i.html#gaa3e119957c2944c284ff5f0a415d1d5a">SPLIT_MAX_LEN_UFRAME</a> ? 1 : 0); <span class="comment">/*-- Number of Split Transactions --*/</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  memset(<a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx), 0, <span class="keyword">sizeof</span>(HCD_SITD) );</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;inUse = 1;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;IhdIdx = HeadIdx;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">/*-- Word 1 --*/</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;Horizontal.Link = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">/*-- Word 2 --*/</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;DeviceAddress = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;DeviceAddress;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;EndpointNumber = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;EndpointNumber;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;HubAddress = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;HubAddress;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;PortNumber = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;PortNumber;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;Direction = <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;Direction;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">/*-- Word 3 --*/</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;uFrameSMask = (1 &lt;&lt; TCount) - 1;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;uFrameCMask = 0;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">/*-- Word 4 --*/</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;Active = 1;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;TotalBytesToTransfer = TDLen;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;IntOnComplete = <a class="code" href="_e_h_c_i_8h.html#afd158f5b8d90362bb3254258e3dbabb6">IntOnComplete</a>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="comment">/*-- Word 5 --*/</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[0] = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) dataBuff;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="comment">/*-- Word 6 --*/</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[1] = Align4k( ((<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) dataBuff) + TDLen);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[1] |= TCount &lt;&lt; TCount_Pos;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;BufferPointer[1] |= (TCount &gt; 1 ? 1 : 0 ) &lt;&lt; TPos_Pos;<span class="comment">/*-- TPosition - More than 1 split --&gt; Begin Encoding, Otherwise All Encoding  --*/</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="comment">// HcdSITD(*pTdIdx)-&gt;TCount = NoSplits;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">// HcdSITD(*pTdIdx)-&gt;TPosition = (NoSplits &gt; 1) ? 1 : 0 ; /*-- TPosition - More than 1 split --&gt; Begin Encoding, Otherwise All Encoding  --*/</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">/*-- Word 7 --*/</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, *pTdIdx)-&gt;BackPointer = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770ab5ec11426e12ff6a6799bee348a61842">HCD_STATUS_NOT_ENOUGH_SITD</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga73c8a4e236d4f592b5053fc26bbb3c8a">QueueSITDs</a>(uint8_t HostID, uint8_t HeadIdx, uint8_t *dataBuff, <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> xferLen)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> FrameIdx;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="preprocessor">#if 0 </span><span class="comment">/* Maximum bandwidth (Interval = 1) regardless of Interval value */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="preprocessor"></span> uint8_t XactPerITD;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> FramePeriod;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(IhdIdx)-&gt;Interval &lt; 4) { <span class="comment">/*-- Period &lt; 8 --*/</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  FramePeriod = 1;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  FramePeriod = 1 &lt;&lt; ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(IhdIdx)-&gt;Interval - 4 ); <span class="comment">/*-- Frame step 4 =&gt; 1, 5 =&gt; 2, 6 =&gt; 3 --*/</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="preprocessor"></span><span class="preprocessor"> #define FramePeriod     1</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; <span class="keywordflow">if</span> (xferLen &gt; <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;MaxPackageSize * <a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>) { <span class="comment">/*-- Data length overflow the Period FRAME LIST  --*/</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6f0f28626075ee3be7f399dcf38d0a15">ASSERT_STATUS_OK_MESSAGE</a>(</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770ab9821977ac8da775567ffe66120ee9f7">HCD_STATUS_DATA_OVERFLOW</a>,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="stringliteral">&quot;ISO data length overflows the Period Frame List size, Please increase size by FRAMELIST_SIZE_BITS or reduce data length&quot;</span>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; FrameIdx = <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;FRINDEX_H &gt;&gt; 3;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; <span class="keywordflow">while</span> (xferLen) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdIdx;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TDLen;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  TDLen = <a class="code" href="group___l_p_c___types___public___macros.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(xferLen, <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, HeadIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#acc282a6d17747e66fc80c96fb0cd38e8">MaxPackageSize</a>);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  xferLen -= TDLen;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <a class="code" href="group___group___h_c_d.html#ga6b01ac0483f124d99a8bd6eed4b7feb4">ASSERT_STATUS_OK</a>(<a class="code" href="group___host___e_h_c_i.html#ga881fa4095fa5b0ea4c96f5b5069d6be9">AllocSItd</a>(HostID, &amp;TdIdx, HeadIdx, dataBuff, TDLen, xferLen ? 0 : 1) );</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  FrameIdx = (FrameIdx + FramePeriod) % FRAME_LIST_SIZE;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="comment">/*-- Hook SITD to Period List Base --*/</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga36a6feb6453eeca2db858455e5735edb">InsertLinkPointer</a>(&amp;<a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[FrameIdx], &amp;<a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(HostID, TdIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#a12e69c122c30b1fddc79775a8736c724">Horizontal</a>, <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487ad758c6972d6d7e1067715f01df0f0f2c">SITD_TYPE</a>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  dataBuff += TDLen;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;}</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga2533035484510105e07db0ff204963fa">WaitForTransferComplete</a>(uint8_t HostID, uint8_t <a class="code" href="_o_h_c_i_8h.html#ad1af8cced601ae250ab4fad04bcc76ac">EdIdx</a>)<span class="comment">/* TODO indentical to OHCI now */</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;{</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="preprocessor">#ifndef __TEST__</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, EdIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#af65ae05bcce5786d892c6a2bd1141292">status</a> == <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770acb7f44e80fbfbdab4b623f5433195e8f">HCD_STATUS_TRANSFER_QUEUED</a> ) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">/* Should have time-out but left blank intentionally for bug catcher */</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; <span class="keywordflow">return</span> (<a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a>) <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, EdIdx)-&gt;status;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor"></span> <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> Pipehandle, uint8_t *pHostID, <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> *XferType, uint8_t *pIdx)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;{</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; <a class="code" href="struct_pipe___handle___t.html">Pipe_Handle_T</a> *pHandle = (<a class="code" href="struct_pipe___handle___t.html">Pipe_Handle_T</a> *) (&amp;Pipehandle);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; <span class="keywordflow">if</span>  ((pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a96a2699f4e3de41fb5679bae13096713">HostId</a> &gt;= MAX_USB_CORE) ||</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   ( pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a9798457c5468a2277c9a6a2716b10a5a">Idx</a> &gt;= <a class="code" href="group___host___e_h_c_i.html#ga2b62e2f86ed8efba89ec1ba8d005dbb6">HCD_MAX_QTD</a>) ||</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a96a2699f4e3de41fb5679bae13096713">HostId</a>, pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a9798457c5468a2277c9a6a2716b10a5a">Idx</a>)-&gt;inUse == 0) ||</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   ( <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a96a2699f4e3de41fb5679bae13096713">HostId</a>, pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a9798457c5468a2277c9a6a2716b10a5a">Idx</a>)-&gt;status == <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7d3c643b34e337357530073b20a600a3">HCD_STATUS_TO_BE_REMOVED</a>) ) {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a64c9fba05aee5b76ad47a39afc962e4e">HCD_STATUS_PIPEHANDLE_INVALID</a>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; <span class="keywordflow">if</span> (pHostID) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  *pHostID = pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a96a2699f4e3de41fb5679bae13096713">HostId</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; <span class="keywordflow">if</span> (pIdx) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  *pIdx = pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a9798457c5468a2277c9a6a2716b10a5a">Idx</a>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; <span class="keywordflow">if</span> (XferType) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  *XferType = (<a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a>) pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#aeff746a68ed515a1d9f0c40a38dd200b">Type</a>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gaf36bcbb02e524cd8236a726fb412727a">PipehandleCreate</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> *pPipeHandle, uint8_t HostID, <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType, uint8_t idx)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;{</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; <span class="comment">/*---------- HostID | PortNum | Type | Idx ----------*/</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; <a class="code" href="struct_pipe___handle___t.html">Pipe_Handle_T</a> *pHandle = (<a class="code" href="struct_pipe___handle___t.html">Pipe_Handle_T</a> *) pPipeHandle;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a96a2699f4e3de41fb5679bae13096713">HostId</a> = HostID;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a7b1124453ea43f7e9569847aa322c83c">PortNumber</a> = 0;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#aeff746a68ed515a1d9f0c40a38dd200b">Type</a> = (uint8_t) XferType;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; pHandle-&gt;<a class="code" href="struct_pipe___handle___t.html#a9798457c5468a2277c9a6a2716b10a5a">Idx</a> = idx;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;}</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>    <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(uint8_t HostID)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;{</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#a2f9828a9fc6052dc65bdeab49a9e98a5">AsyncHeadQhd</a>);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; <span class="comment">// return &amp;(ehci_data.AsyncHeadQhd);</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>    <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(uint8_t HostID)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;{</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#ac1b5f701114059565bf3794b7b9c8db6">IntHeadQhd</a>);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; <span class="comment">// return &amp;(ehci_data.IntHeadQhd);</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;}</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">// === TODO: Deal with HostID later ===</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>    <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(uint8_t HostID, uint8_t idx)</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;{</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#a3eba8f5c99447dbe095f5c90239970c1">qHDs</a>[idx]);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; <span class="comment">// return &amp;(ehci_data.qHDs[idx]);</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="keyword">static</span> __INLINE PHCD_QTD    <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(uint8_t HostID, uint8_t idx)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;{</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#a20d7d134bffa001caaeba43a1c2afec1">qTDs</a>[idx]);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; <span class="comment">// return &amp;(ehci_data.qTDs[idx]);</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;}</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a>   <a class="code" href="group___host___e_h_c_i.html#ga318053747c6a09dcd95f50fec45d2366">HcdSITD</a>(uint8_t HostID, uint8_t idx)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;{</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#a1f5726f6b26c84eb0d4fedbb120bc989">siTDs</a>[idx]);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; <span class="comment">// return &amp;(ehci_data.siTDs[idx]);</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;}</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a> <a class="code" href="group___host___e_h_c_i.html#ga5463b4e1cba1609fca9fe4a25097062d">HcdHsITD</a>(uint8_t HostID, uint8_t idx)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;{</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; <span class="keywordflow">return</span> &amp;(<a class="code" href="group___host___e_h_c_i.html#ga37dcf62fca85fb4f1dc948dbcffe3d77">ehci_data</a>[HostID].<a class="code" href="struct_e_h_c_i___h_o_s_t___d_a_t_a___t.html#ac4dc9a75380669ff1588878364881d12">iTDs</a>[idx]);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; <span class="comment">// return &amp;(ehci_data.iTDs[idx]);</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;}</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keyword">static</span> __INLINE <span class="keywordtype">bool</span>        <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> link)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;{</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; <span class="keywordflow">return</span> (link &amp; <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>) == 0;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;}</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keyword">static</span> __INLINE <span class="keywordtype">bool</span> <a class="code" href="group___host___e_h_c_i.html#ga9ba6602d794a9a2e7dcc8d5b22f846da">IsInterruptQhd</a>(uint8_t HostID, uint8_t QhdIdx)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;{</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;uFrameSMask;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordtype">void</span>    <a class="code" href="group___group___h_a_l___l_p_c17xx.html#gacf4a0c4c7e8ed0d9680d33469040c9d7" title="Interrupt Handler (Host side). This handler is known as interrupt service routine of USB Host...">HcdIrqHandler</a>(uint8_t HostID)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;{</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> <a class="code" href="group___l_p_c___types___public___types.html#gab7d263072f745b4f3913fb0afc434c4e">IntStatus</a>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> t = <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBINTR_H;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; IntStatus = <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; t;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; <span class="keywordflow">if</span> (IntStatus == 0) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; <span class="comment">/* disable all interrupt for processing */</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; <span class="comment">/* Acknowledge Interrrupt */</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H |= <a class="code" href="group___l_p_c___types___public___types.html#gab7d263072f745b4f3913fb0afc434c4e">IntStatus</a>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; <span class="comment">/* Process Interrupt Sources */</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; <span class="keywordflow">if</span> (IntStatus &amp; <a class="code" href="group___host___e_h_c_i.html#gaf01f58c971332f77ae2269dfdbac04b6">EHC_USBSTS_PortChangeDetect</a>) {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PortSC = <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keywordflow">if</span> (PortSC &amp; <a class="code" href="group___host___e_h_c_i.html#ga67d8102e70c94c19f2f047bf6539ecb7">EHC_PORTSC_ConnectStatusChange</a>) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga9592bcfb6a42800688131169728bf5da">PortStatusChangeIsr</a>(HostID, PortSC &amp; EHC_PORTSC_CurrentConnectStatus);</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#ga67d8102e70c94c19f2f047bf6539ecb7">EHC_PORTSC_ConnectStatusChange</a>; <span class="comment">/* Clear PortSC Interrupt Status */</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">if</span> (PortSC &amp; <a class="code" href="group___host___e_h_c_i.html#ga2ab6f565c5bb23b698d1d3143beab03b">EHC_PORTSC_PortEnableChange</a>) {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#ga2ab6f565c5bb23b698d1d3143beab03b">EHC_PORTSC_PortEnableChange</a>;  <span class="comment">/* Clear PortSC Interrupt Status */</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (PortSC &amp; <a class="code" href="group___host___e_h_c_i.html#gac1b0e55bf0c345c554643f46b939d923">EHC_PORTSC_OvercurrentChange</a>) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#gac1b0e55bf0c345c554643f46b939d923">EHC_PORTSC_OvercurrentChange</a>; <span class="comment">/* Clear PortSC Interrupt Status */</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">if</span> (PortSC &amp; <a class="code" href="group___host___e_h_c_i.html#ga57b662f4b1c4f8301cd2065ebebff21b">EHC_PORTSC_ForcePortResume</a>) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#ga57b662f4b1c4f8301cd2065ebebff21b">EHC_PORTSC_ForcePortResume</a>;  <span class="comment">/* Clear PortSC Interrupt Status */</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; <span class="keywordflow">if</span> (IntStatus &amp; <a class="code" href="group___host___e_h_c_i.html#gad4ac36f75a9891ba595928a4598c49c1">EHC_USBSTS_UsbAsyncInt</a>) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaeabc141626e341ba64cd5b2a9cb1073b">AsyncScheduleIsr</a>(HostID);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; <span class="keywordflow">if</span> (IntStatus &amp; <a class="code" href="group___host___e_h_c_i.html#gad75c223dca9f2686796d7ff0b4422d17">EHC_USBSTS_UsbPeriodInt</a>) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga9224e8f6f19f9bef85d862fa472129f6">PeriodScheduleIsr</a>(HostID);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; <span class="keywordflow">if</span> (IntStatus &amp; <a class="code" href="group___host___e_h_c_i.html#gaf5fd3796eb3df3887819b07c1dfb2948">EHC_USBSTS_UsbErrorInt</a>) {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga179d3dd585deb582ba69f0a8df48845e">UsbErrorIsr</a>(HostID);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; <span class="keywordflow">if</span> (IntStatus &amp; <a class="code" href="group___host___e_h_c_i.html#gab923a040ab9bfa946516840be7614b09">EHC_USBSTS_IntAsyncAdvance</a>) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gafa31133cb33f289af1f32eedf992e025">AsyncAdvanceIsr</a>(HostID);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; }</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; <span class="comment">/* Enable Interrupt */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;}</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> RemoveCompletedQTD(uint8_t HostID, <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd)</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;{</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; PHCD_QTD pQtd;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdLink = pQhd-&gt;FirstQtd;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; <span class="keywordtype">bool</span> is_data_remain = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; <span class="comment">/*-- Foreach Qtd in Qhd --*/</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; <span class="keywordflow">while</span>( (<a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(TdLink), pQtd = (PHCD_QTD) Align32(TdLink) ) &amp;&amp;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   pQtd-&gt;Active == 0)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  TdLink = pQtd-&gt;NextQtd;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span>(pQhd-&gt;pActualTransferCount)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   *(pQhd-&gt;pActualTransferCount) -= pQtd-&gt;TotalBytesToTransfer;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  if (pQtd-&gt;IntOnComplete)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="keywordflow">if</span>(PipeStreaming[HostID].RemainBytes &gt; 0)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    is_data_remain = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    pQhd-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">if</span> (pQtd-&gt;Halted <span class="comment">/*|| pQtd-&gt;Babble || pQtd-&gt;BufferError || pQtd-&gt;TransactionError*/</span>)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   pQhd-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770aece07793055b4e74e62ef69e88f28d9c">HCD_STATUS_TRANSFER_Stall</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga4bad6030f9a671d0ddb3b2d487563d94">FreeQtd</a>(pQtd);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; pQhd-&gt;FirstQtd = TdLink;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; <span class="keywordflow">if</span>(is_data_remain)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> pQtd;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gaf95582ce3d53baf979d776958a2ff0a2">QueueQTDs</a>(HostID, &amp;pQtd,(uint8_t*)PipeStreaming[HostID].BufferAddress,</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    PipeStreaming[HostID].RemainBytes,</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    pQhd-&gt;Direction ? <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a4a0fb2109190bf3da11ea81c0b3f7d1f">IN_TRANSFER</a> : <a class="code" href="group___group___h_c_d.html#gga73cca83d94e0ec89616c7e834542f2d7a85f677807fd13be9c4d0e33012747fb5">OUT_TRANSFER</a>,</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    PipeStreaming[HostID].DataToggle);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  pQhd-&gt;FirstQtd = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,pQtd) );</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  pQhd-&gt;Overlay.NextQtd = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gaecd4f14d466d94f3a40699109f059d1b">HcdQTD</a>(HostID,pQtd);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; } </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> RemoveErrorQTD(<a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;{</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; PHCD_QTD pQtd;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> TdLink = pQhd-&gt;FirstQtd;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; <span class="keywordtype">bool</span> errorfound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; <span class="comment">/*-- Scan error Qtd in Qhd --*/</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; <span class="keywordflow">while</span> ( (<a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(TdLink), pQtd = (PHCD_QTD) Align32(TdLink) ) &amp;&amp;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   pQtd-&gt;Active == 0) {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  TdLink = pQtd-&gt;NextQtd;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">if</span> (pQtd-&gt;Halted <span class="comment">/*|| pQtd-&gt;Babble || pQtd-&gt;BufferError || pQtd-&gt;TransactionError*/</span>) {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   errorfound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   pQhd-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770aece07793055b4e74e62ef69e88f28d9c">HCD_STATUS_TRANSFER_Stall</a>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  }</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; <span class="comment">/*-- Remove error Qtd in Qhd --*/</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; <span class="keywordflow">if</span> (errorfound) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  TdLink = pQhd-&gt;FirstQtd;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(TdLink)) {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   pQtd = (PHCD_QTD) Align32(TdLink);</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;   TdLink = pQtd-&gt;NextQtd;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   pQtd-&gt;Active = 0;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;   pQtd-&gt;IntOnComplete = 0;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga4bad6030f9a671d0ddb3b2d487563d94">FreeQtd</a>(pQtd);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  }</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  pQhd-&gt;FirstQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  pQhd-&gt;Overlay.Halted = 0;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;}</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">/*---------- Interrupt On Compete has occurred, however we have no clues on which QueueHead it happened. Also IOC TD may be advanced already So we will free all TD which is not Active (transferred already) ----------*/</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gaeabc141626e341ba64cd5b2a9cb1073b">AsyncScheduleIsr</a>(uint8_t HostID)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;{</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd = <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; <span class="comment">/*-- Foreach Qhd in async list --*/</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pQhd-&gt;Horizontal.Link) &amp;&amp;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   Align32(pQhd-&gt;Horizontal.Link) != (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID) ) {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  pQhd = (<a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>) Align32(pQhd-&gt;Horizontal.Link);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  RemoveCompletedQTD(HostID,pQhd);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga9224e8f6f19f9bef85d862fa472129f6">PeriodScheduleIsr</a>(uint8_t HostID)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;{</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> i;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; <span class="comment">/*ISOCHRONOUS*/</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>; i++) { <span class="comment">/*-- Foreach link in Period List Base --*/</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *pNextPointer = &amp;<a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[i];</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="comment">/*-- Foreach Itd/SItd in the link--*/</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>) &amp;&amp; pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> != <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a> ) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   <span class="keywordflow">if</span> (pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> == <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a65958b2b656799921b822cb91560bd78">ITD_TYPE</a>) { <span class="comment">/*-- Highspeed ISO --*/</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a> pItd = (<a class="code" href="group___host___e_h_c_i.html#ga35fc2a7284b140429b989ca20b03f9a8">PHCD_HS_ITD</a>) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">if</span> ((pItd-&gt;Transaction[0].Active == 0) &amp;&amp; (pItd-&gt;Transaction[1].Active == 0) &amp;&amp;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;     ( pItd-&gt;Transaction[2].Active == 0) &amp;&amp; ( pItd-&gt;Transaction[3].Active == 0) &amp;&amp;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;     ( pItd-&gt;Transaction[4].Active == 0) &amp;&amp; ( pItd-&gt;Transaction[5].Active == 0) &amp;&amp;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;     ( pItd-&gt;Transaction[6].Active == 0) &amp;&amp; ( pItd-&gt;Transaction[7].Active == 0) ) {</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;     <span class="keywordflow">if</span> ((pItd-&gt;Transaction[0].IntOnComplete == 1) || (pItd-&gt;Transaction[1].IntOnComplete == 1) ||</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      ( pItd-&gt;Transaction[2].IntOnComplete == 1) || ( pItd-&gt;Transaction[3].IntOnComplete == 1) ||</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      ( pItd-&gt;Transaction[4].IntOnComplete == 1) || ( pItd-&gt;Transaction[5].IntOnComplete == 1) ||</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      ( pItd-&gt;Transaction[6].IntOnComplete == 1) || ( pItd-&gt;Transaction[7].IntOnComplete == 1) ) {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="comment">/*-- request complete, signal on Iso Head --*/</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, pItd-&gt;IhdIdx)-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;     }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;     <span class="comment">/*-- remove executed ITD --*/</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;     pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = pItd-&gt;Horizontal.Link;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;     <a class="code" href="group___host___e_h_c_i.html#ga151710f74fbfe7b1283b4350039829ac">FreeHsItd</a>(pItd);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;     <span class="keywordflow">continue</span>; <span class="comment">/*-- skip advance pNextPointer due to TD removal --*/</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a140acdd7ac30628e97d1851104f05c03">Type</a> == <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487ad758c6972d6d7e1067715f01df0f0f2c">SITD_TYPE</a>) { <span class="comment">/*-- Split ISO --*/</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a> pSItd = (<a class="code" href="group___host___e_h_c_i.html#ga1967366123625acaf25807189e72404a">PHCD_SITD</a>) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">if</span> (pSItd-&gt;Active == 0) {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;     <span class="keywordflow">if</span> (pSItd-&gt;IntOnComplete) {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">/*-- request complete, signal on Iso Head --*/</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, pSItd-&gt;IhdIdx)-&gt;status = <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;     }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;     <span class="comment">/*-- removed executed SITD --*/</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;     pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a> = pSItd-&gt;Horizontal.Link;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;     <a class="code" href="group___host___e_h_c_i.html#gaa43742bc0c51f164bd795183d4054ec9">FreeSItd</a>(pSItd);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;     <span class="keywordflow">continue</span>; <span class="comment">/*-- skip advance pNextPointer due to TD removal --*/</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   pNextPointer = (<a class="code" href="union_next_link_pointer.html">NextLinkPointer</a> *) Align32(pNextPointer-&gt;<a class="code" href="union_next_link_pointer.html#a051375a1c89177460d1d032e486464e7">Link</a>);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; <span class="comment">/*INTERRUPT*/</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd = <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="comment">/*-- Foreach Qhd in list --*/</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pQhd-&gt;Horizontal.Link) ) {</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   pQhd = (<a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>) Align32(pQhd-&gt;Horizontal.Link);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   RemoveCompletedQTD(HostID,pQhd);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;}</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga179d3dd585deb582ba69f0a8df48845e">UsbErrorIsr</a>(uint8_t HostID)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;{</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a> pQhd = <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; <span class="comment">/*-- Foreach Qhd in async list --*/</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; <span class="keywordflow">while</span> ( <a class="code" href="group___host___e_h_c_i.html#ga2f1667a33f67ccf7e822aed1137b0c7a">isValidLink</a>(pQhd-&gt;Horizontal.Link) &amp;&amp;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   Align32(pQhd-&gt;Horizontal.Link) != (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID) ) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  pQhd = (<a class="code" href="group___host___e_h_c_i.html#ga73b5236f9629a6b91da2943a6607a292">PHCD_QHD</a>) Align32(pQhd-&gt;Horizontal.Link);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  RemoveErrorQTD(pQhd);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;}</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="keyword">static</span> <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga9592bcfb6a42800688131169728bf5da">PortStatusChangeIsr</a>(uint8_t HostID, <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> deviceConnect)</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;{</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; <span class="keywordflow">if</span> (deviceConnect) {<span class="comment">/* Device Attached */</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga4d144cab7eed704d425bea9217d22102">USB_Host_Enumerate</a>(HostID);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; <span class="keywordflow">else</span> { <span class="comment">/* Device detached */</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga9bd0611af849522cb1f4925afe537517">USB_Host_DeEnumerate</a>(HostID);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;}</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gafa31133cb33f289af1f32eedf992e025">AsyncAdvanceIsr</a>(uint8_t HostID)</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> QhdIdx;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; <span class="keywordflow">for</span> (QhdIdx = 0; QhdIdx &lt; <a class="code" href="group___host___e_h_c_i.html#gaad95930a369a3585269645fda9b870c9">HCD_MAX_QHD</a>; QhdIdx++)</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#adc5110901bc5e72ee5aa532f28418e25">inUse</a> == 1) &amp;&amp; (<a class="code" href="group___host___e_h_c_i.html#ga0b1e98dc5108038e09412b52467f1fa2">HcdQHD</a>(HostID, QhdIdx)-&gt;<a class="code" href="_e_h_c_i_8h.html#af65ae05bcce5786d892c6a2bd1141292">status</a> == <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a7d3c643b34e337357530073b20a600a3">HCD_STATUS_TO_BE_REMOVED</a>)) {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <a class="code" href="group___host___e_h_c_i.html#ga5c3e4a6982d0caf87344e9b8ca680236">FreeQhd</a>(HostID, QhdIdx);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;}</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gaaaadd80ac62b6051dd2ac476c04afc94">EHciHostRun</a>(uint8_t HostID)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;{</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H |= <a class="code" href="group___host___e_h_c_i.html#gaa0ec1edcbd4d46fc50f0797f1e889d71">EHC_USBCMD_RunStop</a>;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; <span class="keywordflow">while</span> (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; <a class="code" href="group___host___e_h_c_i.html#ga2e6bb8aec5a835722d5cf97fa8560d36">EHC_USBSTS_HCHalted</a>) {}</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gacfedb88693785c61dff724a7e00381d4">EHciHostStop</a>(uint8_t HostID)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;{</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H &amp;= ~<a class="code" href="group___host___e_h_c_i.html#gaa0ec1edcbd4d46fc50f0797f1e889d71">EHC_USBCMD_RunStop</a>;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; <span class="keywordflow">while</span> ( !(<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; <a class="code" href="group___host___e_h_c_i.html#ga2e6bb8aec5a835722d5cf97fa8560d36">EHC_USBSTS_HCHalted</a>) ) {}</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;}</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#ga8b57fc562a04d94e94efab41d3226712">EHciHostReset</a>(uint8_t HostID)</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;{</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; <a class="code" href="group___host___e_h_c_i.html#ga2e6bb8aec5a835722d5cf97fa8560d36">EHC_USBSTS_HCHalted</a>) {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#gacfedb88693785c61dff724a7e00381d4">EHciHostStop</a>(HostID);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; }</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H |= <a class="code" href="group___host___e_h_c_i.html#gaca765a9083a3eeccaeb5fee1ff9b3e32">EHC_USBCMD_HostReset</a>;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; <span class="keywordflow">while</span> ( <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H &amp; <a class="code" href="group___host___e_h_c_i.html#gaca765a9083a3eeccaeb5fee1ff9b3e32">EHC_USBCMD_HostReset</a> ) {}</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; <span class="comment">/* Program the controller to be the USB host controller, this can only be done after Reset */</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBMODE_H = 0x23; <span class="comment">// USBMODE_HostController | USBMODE_VBusPowerSelect_High;</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;}</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="keyword">static</span> __INLINE <a class="code" href="group___group___h_c_d.html#ga6d626f907875049823d133c88bff0770">HCD_STATUS</a> <a class="code" href="group___host___e_h_c_i.html#gaad8f6214fbf8ce990f92b2fcf9921025">EHciHostInit</a>(uint8_t HostID)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;{</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> idx;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; <span class="comment">/*---------- Host Data Structure Init ----------*/</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; <span class="comment">// memset(&amp;ehci_data[HostID], 0, sizeof(EHCI_HOST_DATA_T) );</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; <span class="comment">/*---------- USBINT ----------*/</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBINTR_H &amp;= ~<a class="code" href="group___host___e_h_c_i.html#gacf0eea55ad22a6de5d20d624053aedd5">EHC_USBINTR_ALL</a>; <span class="comment">/* Disable All Interrupt */</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H  &amp;= ~<a class="code" href="group___host___e_h_c_i.html#gacf0eea55ad22a6de5d20d624053aedd5">EHC_USBINTR_ALL</a>; <span class="comment">/* Clear All Interrupt Status */</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBINTR_H =    <a class="code" href="group___host___e_h_c_i.html#gacf6f7ad318766964f00b02df3ed07446">EHC_USBINTR_UsbAsyncEnable</a> | <a class="code" href="group___host___e_h_c_i.html#ga4efeaae8746ebc0586b202c05d8aa738">EHC_USBINTR_UsbPeriodEnable</a> | <span class="comment">/* Enable necessary interrupt source: Async Advance, System Error, Port Change, USB Error, USB Int */</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;         <a class="code" href="group___host___e_h_c_i.html#ga5a722147b4d0e268ed3bed1552518f60">EHC_USBINTR_PortChangeIntEnable</a> | <a class="code" href="group___host___e_h_c_i.html#gabbf237f845e82f7ab3ea2ef928662d1c">EHC_USBINTR_UsbErroIntEnable</a> |</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;         <a class="code" href="group___host___e_h_c_i.html#gad08d7fd7eeacceee1276c9192f95ca8a">EHC_USBINTR_IntAsyncAdvanceEnable</a> |</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;         (<a class="code" href="group___host___e_h_c_i.html#ga920263ed220b419008dc9d5a2b57c178">INT_FRAME_ROLL_OVER_ENABLE</a> ? <a class="code" href="group___host___e_h_c_i.html#ga9785c8842be14f1939a623cb25917fa5">EHC_USBINTR_FrameListRolloverEnable</a> : 0);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; <span class="comment">/*---------- Asynchronous List ----------*/</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; <span class="comment">/*-- Static Head Qhd with Halted/inactive --*/</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;Horizontal.Link = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID) );</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;Horizontal.Type = <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;HeadReclamationFlag = 1;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;Overlay.NextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;  <span class="comment">/* Terminate Links */</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;Overlay.AlterNextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>; <span class="comment">/* Terminate Links */</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID)-&gt;Overlay.Halted = 1;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;ASYNCLISTADDR = (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#gacbb15183eafc60a2c8109bc46264dea0">HcdAsyncHead</a>(HostID);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; <span class="comment">/*---------- Periodic List ----------*/</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; <span class="comment">/*-- Static Interrupt Qhd (1 ms) --*/</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;Horizontal.Link = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;Overlay.NextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>;  <span class="comment">/* Terminate Links */</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;Overlay.AlterNextQtd = <a class="code" href="_h_a_l___l_p_c11_uxx_8h.html#a83dd1b2375182f894eef3952ab54f107">LINK_TERMINATE</a>; <span class="comment">/* Terminate Links */</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;Overlay.Halted = 1;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID)-&gt;uFrameSMask = 1;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="group___host___e_h_c_i.html#ga08ca8ee3c7882d83f94e96d3e7715a5d">FRAME_LIST_SIZE</a>; idx++) {   <span class="comment">/* Attach 1 ms Interrupt Qhd to Period Frame List */</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[idx].Link = Align32( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#ga36cc886c6d805316f26f0c6d839f98da">HcdIntHead</a>(HostID) );</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID)[idx].Type = <a class="code" href="group___host___e_h_c_i.html#gga78fd750c653bfcd2dc949ceec6cef487a27052d2d3c490265ee27b1cfa652c1ee">QHD_TYPE</a>;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PERIODICLISTBASE = Align4k( (<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a>) <a class="code" href="group___host___e_h_c_i.html#ga6d8b4b46858b021c04bea30df7b263c3">EHCI_FRAME_LIST</a>(HostID) );</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; <span class="comment">/*---------- USBCMD ----------*/</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H =    <a class="code" href="group___host___e_h_c_i.html#ga7278da606d4a6426f592070354a55f18">EHC_USBCMD_AsynScheduleEnable</a> |</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;         ((<a class="code" href="group___host___e_h_c_i.html#gac0b79ccd431f779ec1be90a20a4fa1e6">FRAMELIST_SIZE_BITS</a> % 4) &lt;&lt; 2) | ((<a class="code" href="group___host___e_h_c_i.html#gac0b79ccd431f779ec1be90a20a4fa1e6">FRAMELIST_SIZE_BITS</a> / 4) &lt;&lt; 15);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; <span class="comment">/*---------- CONFIGFLAG ----------*/</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; <span class="comment">/* LPC18xx doesn&#39;t has CONFIGFLAG register */</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; <span class="comment">/*---------- Power On RhPort ----------*/</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;PORTSC1_H |= <a class="code" href="group___host___e_h_c_i.html#gadf3507fce90514e42f448589d84e1793">EHC_PORTSC_PortPowerControl</a>;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaaaadd80ac62b6051dd2ac476c04afc94">EHciHostRun</a>(HostID);<span class="comment">/* Run The HC */</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; <span class="keywordflow">return</span> <a class="code" href="group___group___h_c_d.html#gga6d626f907875049823d133c88bff0770a6c77b41ead842c2c7406e723931209e5">HCD_STATUS_OK</a>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;}</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="keyword">static</span> __INLINE <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga4285cb83300fac9a0ab772a19f0320d0">DisableSchedule</a>(uint8_t HostID, uint8_t isPeriod)</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;{</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> statusMask = isPeriod ? <a class="code" href="group___host___e_h_c_i.html#gac0504ab860eab36b260e6b9ef68dbb7d">EHC_USBSTS_PeriodScheduleStatus</a> : <a class="code" href="group___host___e_h_c_i.html#gae11b455ed2298bfc0556d7ec56cd0bb9">EHC_USBSTS_AsyncScheduleStatus</a>;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> cmdMask = isPeriod ? <a class="code" href="group___host___e_h_c_i.html#gad98ad1e2df98f97da2903c8a672da0c2">EHC_USBCMD_PeriodScheduleEnable</a> : <a class="code" href="group___host___e_h_c_i.html#ga7278da606d4a6426f592070354a55f18">EHC_USBCMD_AsynScheduleEnable</a>;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; statusMask) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H &amp;= ~cmdMask;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; statusMask) {} <span class="comment">/* TODO Should have time-out */</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;}</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keyword">static</span> __INLINE <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gaff7c53d303b2d85cb5c31a641338bf89">EnableSchedule</a>(uint8_t HostID, uint8_t isPeriod)</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;{</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> statusMask = isPeriod ? <a class="code" href="group___host___e_h_c_i.html#gac0504ab860eab36b260e6b9ef68dbb7d">EHC_USBSTS_PeriodScheduleStatus</a> : <a class="code" href="group___host___e_h_c_i.html#gae11b455ed2298bfc0556d7ec56cd0bb9">EHC_USBSTS_AsyncScheduleStatus</a>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; <a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> cmdMask = isPeriod ? <a class="code" href="group___host___e_h_c_i.html#gad98ad1e2df98f97da2903c8a672da0c2">EHC_USBCMD_PeriodScheduleEnable</a> : <a class="code" href="group___host___e_h_c_i.html#ga7278da606d4a6426f592070354a55f18">EHC_USBCMD_AsynScheduleEnable</a>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; <span class="keywordflow">if</span> (!(<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; statusMask)) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBCMD_H |= cmdMask;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordflow">while</span> (!(<a class="code" href="group___group___h_a_l___l_p_c17xx.html#ga60edd8702ae2a3c804fd925cae4a9f8b">USB_REG</a>(HostID)-&gt;USBSTS_H &amp; statusMask)) {}<span class="comment">/* TODO Should have time-out */</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; }</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga58cefec516a4db85547a2c3341327de8">DisableAsyncSchedule</a>(uint8_t HostID)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;{</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga4285cb83300fac9a0ab772a19f0320d0">DisableSchedule</a>(HostID, 0);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;}</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gab89d08ef6aae4306eff1dc00a14cc629">EnableAsyncSchedule</a>(uint8_t HostID)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;{</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaff7c53d303b2d85cb5c31a641338bf89">EnableSchedule</a>(HostID, 0);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;}</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#ga9fd1a765b6d100bfb1ef5040956763c6">DisablePeriodSchedule</a>(uint8_t HostID)</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;{</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; <a class="code" href="group___host___e_h_c_i.html#ga4285cb83300fac9a0ab772a19f0320d0">DisableSchedule</a>(HostID, 1);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;}</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group___host___e_h_c_i.html#gad1d134c340b7746210ca40d4bb5d14cc">EnablePeriodSchedule</a>(uint8_t HostID)</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;{</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gaff7c53d303b2d85cb5c31a641338bf89">EnableSchedule</a>(HostID, 1);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;}</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keywordtype">void</span> <a class="code" href="group___group___h_c_d.html#ga3eef04167651a6bc9852698e71356978" title="Set size of each packet in a continuous data transfer.">HcdSetStreamPacketSize</a>(<a class="code" href="_e_h_c_i_8h.html#ad14d3f736deaab092d7bc0dcb1430bc8">uint32_t</a> PipeHandle, uint16_t packetsize)</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;{</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; uint8_t HostID = 0, HeadIdx;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; <a class="code" href="group___group___h_c_d.html#ga591c7d63482e6bd11c5a8bbb3629aff6">HCD_TRANSFER_TYPE</a> XferType;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160; <a class="code" href="group___host___e_h_c_i.html#gadd8bc53000156d3bfcebfeabe2e583f7">PipehandleParse</a>(PipeHandle, &amp;HostID, &amp;XferType, &amp;HeadIdx);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; PipeStreaming[HostID].PacketSize = packetsize;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;}</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="preprocessor">#endif // __LPC_EHCI__</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c8fa76d8dc1b9e06ff8aeb3121608b1b.html">software</a></li><li class="navelem"><a class="el" href="dir_d62a665ad4ae936cbe124efed6595ef8.html">LPCUSBLib</a></li><li class="navelem"><a class="el" href="dir_6eea2d09bf243bbb3b5c8b4db6ea8f28.html">Drivers</a></li><li class="navelem"><a class="el" href="dir_a945aa6c48d5469717916b169f2e84f9.html">USB</a></li><li class="navelem"><a class="el" href="dir_f1416a4185982af3073526802bde95ee.html">Core</a></li><li class="navelem"><a class="el" href="dir_fbce2c2372ad2071f89dda3cf9d9bbdb.html">HCD</a></li><li class="navelem"><a class="el" href="dir_8a937fc7f133d58faf2df6882df26507.html">EHCI</a></li><li class="navelem"><a class="el" href="_e_h_c_i_8c.html">EHCI.c</a></li>
    <li class="footer">Generated on Fri May 10 2013 10:42:23 for LPCOpen Platform by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
